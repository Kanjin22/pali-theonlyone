<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Schedule Builder) - Pali The Only One</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="system_config.js"></script>
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f5f6fa;
            color: #2c3e50;
            margin: 0;
            padding: 20px;
        }
        .container {
            display: none; /* Hide by default for security */
            max-width: 95%; /* Use more width */
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        h1, h2 {
            text-align: center;
            color: #2c3e50;
        }
        .config-section {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        label {
            font-weight: bold;
            font-size: 0.9em;
        }
        input, select {
            padding: 8px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            font-family: 'Sarabun', sans-serif;
            width: 100%;
            box-sizing: border-box;
        }
        .readonly-input {
            background-color: #e0e0e0;
            color: #7f8c8d;
            cursor: not-allowed;
        }
        button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Sarabun', sans-serif;
            font-weight: bold;
            transition: background 0.3s;
            white-space: nowrap;
        }
        button:hover {
            background-color: #2980b9;
        }
        button.success {
            background-color: #2ecc71;
        }
        button.success:hover {
            background-color: #27ae60;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1000;
            display: flex; justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; padding: 20px; border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        .modal-close {
            position: absolute; top: 10px; right: 15px;
            font-size: 24px; cursor: pointer; color: #aaa;
        }
        .search-result-item {
            padding: 10px; border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .search-result-item:hover { background: #f9f9f9; }
        .search-result-item strong { color: #2c3e50; display: block; }
        .search-result-item small { color: #7f8c8d; }

        /* Table Styles */
        .editor-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .editor-table th, .editor-table td {
            border: 1px solid #ddd;
            padding: 10px;
            vertical-align: top;
        }
        .editor-table th {
            background-color: #34495e;
            color: white;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .editor-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .weekend-row {
            background-color: #ffeaa7 !important;
        }
        
        /* Input Groups within Cell */
        .slot-container {
            display: flex;
            flex-direction: column;
            gap: 5px;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        .slot-container:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .slot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3px;
        }
        .slot-label {
            font-weight: bold;
            font-size: 0.85em;
            color: #7f8c8d;
            background: #eee;
            padding: 2px 8px;
            border-radius: 4px;
        }
        
        /* Exam Toggle */
        .exam-toggle {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85em;
            cursor: pointer;
        }
        .exam-toggle input {
            width: auto;
        }
        
        /* Slot Inputs */
        .input-row {
            display: flex;
            gap: 5px;
        }
        .input-mini {
            font-size: 0.85em;
            padding: 4px;
        }
        .is-exam-mode {
            background-color: #ffe6e6;
            border: 1px solid #ffcccc;
            padding: 5px;
            border-radius: 5px;
        }
        .exam-details {
            display: none;
            margin-top: 5px;
            padding: 8px;
            background: #fff5f5;
            border: 1px dashed #e57373;
            border-radius: 4px;
        }
        
        /* New Subject Section Styles */
        .subject-section {
            background: #f8f9fa;
            border-left: 3px solid #3498db;
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 0 4px 4px 0;
        }
        .subject-label {
            font-size: 0.8em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 4px;
            display: block;
        }
        .subject-section input, .subject-section textarea {
            margin-bottom: 4px;
            font-size: 0.85em;
        }

        .output-section {
            margin-top: 30px;
            border-top: 2px solid #eee;
            padding-top: 20px;
        }
        textarea {
            width: 100%;
            height: 300px;
            font-family: 'Courier New', monospace;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1><i class="fa-solid fa-calendar-plus"></i> ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Schedule Builder)</h1>
    <p style="text-align: center;">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ (‡∏õ.‡πë-‡πí ‡∏ñ‡∏∂‡∏á ‡∏õ.‡∏ò.‡πô)</p>

    <div class="config-section">
        <div class="form-group">
            <label><i class="fa-solid fa-layer-group"></i> ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô (Level)</label>
            <select id="selectLevel" onchange="updateRoomList()">
                <option value="pt12">‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡πë-‡πí</option>
                <option value="pt3">‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡∏õ.‡∏ò.‡πì</option>
                <option value="pt4">‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡∏õ.‡∏ò.‡πî</option>
                <option value="pt5">‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡∏õ.‡∏ò.‡πï</option>
                <option value="pt6">‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡∏õ.‡∏ò.‡πñ</option>
                <option value="pt7">‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡∏õ.‡∏ò.‡πó</option>
                <option value="pt8">‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡∏õ.‡∏ò.‡πò</option>
                <option value="pt9">‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡∏õ.‡∏ò.‡πô</option>
            </select>
        </div>
        
        <div class="form-group">
            <label><i class="fa-solid fa-door-open"></i> ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Classroom)</label>
            <select id="selectRoom" onchange="updateVarName()">
                <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á --</option>
            </select>
        </div>

        <div class="form-group">
            <label><i class="fa-regular fa-calendar"></i> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (Month)</label>
            <select id="selectMonth" onchange="updateVarName()">
                <option value="0">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°</option>
                <option value="1">‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
                <option value="2">‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°</option>
                <option value="3">‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô</option>
                <option value="4">‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°</option>
                <option value="5">‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô</option>
                <option value="6">‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°</option>
                <option value="7">‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°</option>
                <option value="8">‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô</option>
                <option value="9">‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°</option>
                <option value="10" selected>‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô</option>
                <option value="11">‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°</option>
            </select>
        </div>
        
        <div class="form-group">
            <label><i class="fa-solid fa-calendar-days"></i> ‡∏õ‡∏µ ‡∏Ñ.‡∏®. (Year AD)</label>
            <input type="number" id="inputYear" value="2025" oninput="updateVarName()">
        </div>
        
        <div class="form-group" style="grid-column: span 2;">
            <label><i class="fa-solid fa-code"></i> ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ (Auto Generated)</label>
            <input type="text" id="varName" class="readonly-input" readonly>
        </div>
        
        <div class="form-group">
            <label>&nbsp;</label>
            <button onclick="generateTable()"><i class="fa-solid fa-rotate"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
        </div>
    </div>

    <!-- Data Lists for Subjects -->
    <datalist id="subjects-pt12">
        <option value="‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢">
        <option value="‡∏ö‡∏≤‡∏•‡∏µ‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå">
    </datalist>
    <datalist id="subjects-pt3">
        <option value="‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢">
        <option value="‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÑ‡∏ó‡∏¢">
        <option value="‡∏ö‡∏≤‡∏•‡∏µ‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå">
        <option value="‡∏ö‡∏∏‡∏£‡∏û‡∏†‡∏≤‡∏Ñ">
    </datalist>
    <datalist id="subjects-pt4">
        <option value="‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏Ñ‡∏ò">
        <option value="‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢">
    </datalist>
    <datalist id="subjects-pt5">
        <option value="‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏Ñ‡∏ò">
        <option value="‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢">
    </datalist>
    <datalist id="subjects-pt6">
        <option value="‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏Ñ‡∏ò">
        <option value="‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢">
    </datalist>
    <datalist id="subjects-pt7">
        <option value="‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏Ñ‡∏ò">
        <option value="‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢">
    </datalist>
    <datalist id="subjects-pt8">
        <option value="‡πÅ‡∏ï‡πà‡∏á‡∏â‡∏±‡∏ô‡∏ó‡πå‡∏°‡∏Ñ‡∏ò">
        <option value="‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏Ñ‡∏ò">
        <option value="‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢">
    </datalist>
    <datalist id="subjects-pt9">
        <option value="‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏Ñ‡∏ò">
        <option value="‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏Ñ‡∏ò">
        <option value="‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢">
    </datalist>

    <div id="tableContainer">
        <!-- Table will be generated here -->
    </div>

    <div class="output-section">
        <h2>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÇ‡∏Ñ‡πâ‡∏î (Output Code)</h2>
        <div class="btn-group">
            <button onclick="generateCode()" class="success"><i class="fa-solid fa-code"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î</button>
            <button onclick="copyCode()"><i class="fa-regular fa-copy"></i> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î</button>
            <button onclick="downloadFile()"><i class="fa-solid fa-download"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå .js</button>
        </div>
        <br>
        <textarea id="outputCode" readonly placeholder="‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå..."></textarea>
    </div>
</div>

<script>
    const thaiMonths = [
        "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
        "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"
    ];
    const thaiMonthsShort = [
        "‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.",
        "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."
    ];
    const thaiDaysShort = ["‡∏≠‡∏≤.", "‡∏à.", "‡∏≠.", "‡∏û.", "‡∏û‡∏§.", "‡∏®.", "‡∏™."];
    const monthNamesEn = ["january", "february", "march", "april", "may", "june", "july", "august", "september", "october", "november", "december"];

    // Configuration for Subjects per Level
    const SUBJECT_CONFIG = {
        "pt12": [
            { id: 'Translate', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏õ‡∏• (Translate)', defaultAct: '‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢' },
            { id: 'Grammar', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå (Grammar)', defaultAct: '‡∏ö‡∏≤‡∏•‡∏µ‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå' }
        ],
        "pt3": [
             { id: 'Translate', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏õ‡∏• (Translate)', defaultAct: '‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢' },
             { id: 'Grammar', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå (Grammar)', defaultAct: '‡∏ö‡∏≤‡∏•‡∏µ‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå' },
             { id: 'Samphan', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå (Relation)', defaultAct: '‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÑ‡∏ó‡∏¢' }
        ],
        "pt4": [ { id: 'Return', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏•‡∏±‡∏ö (Return)', defaultAct: '‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏Ñ‡∏ò' }, { id: 'Translate', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏õ‡∏• (Translate)', defaultAct: '‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢' } ],
        "pt5": [ { id: 'Return', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏•‡∏±‡∏ö (Return)', defaultAct: '‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏Ñ‡∏ò' }, { id: 'Translate', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏õ‡∏• (Translate)', defaultAct: '‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢' } ],
        "pt6": [ { id: 'Return', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏•‡∏±‡∏ö (Return)', defaultAct: '‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏Ñ‡∏ò' }, { id: 'Translate', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏õ‡∏• (Translate)', defaultAct: '‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢' } ],
        "pt7": [ { id: 'Return', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏•‡∏±‡∏ö (Return)', defaultAct: '‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏Ñ‡∏ò' }, { id: 'Translate', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏õ‡∏• (Translate)', defaultAct: '‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢' } ],
        "pt8": [
            { id: 'Chan', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡∏â‡∏±‡∏ô‡∏ó‡πå (Chan)', defaultAct: '‡πÅ‡∏ï‡πà‡∏á‡∏â‡∏±‡∏ô‡∏ó‡πå‡∏°‡∏Ñ‡∏ò' },
            { id: 'Translate', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏õ‡∏• (Translate)', defaultAct: '‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢' },
            { id: 'Return', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏•‡∏±‡∏ö (Return)', defaultAct: '‡πÅ‡∏õ‡∏•‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏Ñ‡∏ò' }
        ],
        "pt9": [ { id: 'Return', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏•‡∏±‡∏ö (Return)', defaultAct: '‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏Ñ‡∏ò' }, { id: 'Translate', label: '‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏õ‡∏• (Translate)', defaultAct: '‡πÅ‡∏õ‡∏•‡∏°‡∏Ñ‡∏ò‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢' } ]
    };

    function updateRoomList() {
        const level = document.getElementById('selectLevel').value;
        const selectRoom = document.getElementById('selectRoom');
        selectRoom.innerHTML = '<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á --</option>';
        
        if (typeof systemConfig !== 'undefined' && systemConfig.classrooms) {
            const rooms = Object.values(systemConfig.classrooms).filter(r => r.level === level && r.status === 'active');
            rooms.forEach(r => {
                const option = document.createElement('option');
                option.value = r.id;
                option.textContent = `${r.name} (${r.id})`;
                selectRoom.appendChild(option);
            });
            
            // Select first room if available
            if (rooms.length > 0) {
                selectRoom.value = rooms[0].id;
            }
        }
        updateVarName();
    }

    function updateVarName() {
        const roomId = document.getElementById('selectRoom').value;
        const monthIdx = document.getElementById('selectMonth').value;
        const year = document.getElementById('inputYear').value;
        const monthName = monthNamesEn[monthIdx];
        
        let prefix = 'data_unknown';
        if (roomId && typeof systemConfig !== 'undefined' && systemConfig.classrooms[roomId]) {
             const roomConfig = systemConfig.classrooms[roomId];
             prefix = `data_${roomConfig.schedulePrefix}`;
        }
        
        const varName = `${prefix}_${monthName}_${year}`;
        document.getElementById('varName').value = varName;
    }


    function generateTable() {
        const roomId = document.getElementById('selectRoom').value;
        if (!roomId) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á");
            return;
        }

        const level = document.getElementById('selectLevel').value;
        const month = parseInt(document.getElementById('selectMonth').value);
        const year = parseInt(document.getElementById('inputYear').value);
        const container = document.getElementById('tableContainer');
        
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        let html = `
            <table class="editor-table">
                <thead>
                    <tr>
                        <th style="width: 10%;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                        <th style="width: 25%;">‡πÄ‡∏ä‡πâ‡∏≤ (Morning)</th>
                        <th style="width: 25%;">‡∏ö‡πà‡∏≤‡∏¢ (Afternoon)</th>
                        <th style="width: 25%;">‡∏Ñ‡πà‡∏≥ (Evening)</th>
                        <th style="width: 15%;">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                    </tr>
                </thead>
                <tbody>
        `;

        const periods = [
            { id: 'morning', label: '‡πÄ‡∏ä‡πâ‡∏≤' },
            { id: 'afternoon', label: '‡∏ö‡πà‡∏≤‡∏¢' },
            { id: 'evening', label: '‡∏Ñ‡πà‡∏≥' }
        ];

        // Get subjects for current level, fallback to pt12 if not found
        const subjects = SUBJECT_CONFIG[level] || SUBJECT_CONFIG['pt12'];

        for (let i = 1; i <= daysInMonth; i++) {
            const date = new Date(year, month, i);
            const dayOfWeek = date.getDay();
            const isWeekend = (dayOfWeek === 0 || dayOfWeek === 6);
            const rowClass = isWeekend ? 'weekend-row' : '';
            
            const dayStr = thaiDaysShort[dayOfWeek];
            const dateStr = `${i < 10 ? '0'+i : i}`;
            const monthStr = thaiMonthsShort[month];
            const yearThai = (year + 543).toString().slice(2);
            const displayDate = `${dayStr} ${dateStr}-${monthStr}-${yearThai}`;
            const dateValue = `${year}-${(month+1).toString().padStart(2, '0')}-${dateStr}`;

            html += `
                <tr class="${rowClass}" id="row-${i}">
                    <td>
                        <strong>${displayDate}</strong>
                        <input type="hidden" class="date-val" value="${dateValue}">
                        <input type="hidden" class="display-date-val" value="${displayDate}">
                        <div class="checkbox-wrapper" style="margin-top: 5px;">
                            <input type="checkbox" id="weekend-${i}" ${isWeekend ? 'checked' : ''} onchange="toggleWeekend(${i})">
                            <label for="weekend-${i}" style="font-size: 0.8em; cursor:pointer;">‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</label>
                        </div>
                    </td>
            `;

            // Generate Columns for Morning, Afternoon, Evening
            periods.forEach(p => {
                html += `<td>
                    <div class="slot-container" id="${p.id}-container-${i}">
                        <div class="slot-header">
                            <span class="slot-label">${p.label}</span>
                            <label class="exam-toggle">
                                <input type="checkbox" class="is-exam-chk" onchange="toggleExamMode(this)"> ‡∏™‡∏≠‡∏ö
                            </label>
                        </div>`;
                
                // --- Generate Dynamic Subject Sections ---
                subjects.forEach(subj => {
                    html += `
                        <div class="subject-section" data-subject-id="${subj.id}">
                            <span class="subject-label">${subj.label}</span>
                            <input type="text" class="input-mini input-subject-act" value="${subj.defaultAct}" placeholder="‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (Activity)">
                            <input type="text" class="input-mini input-subject-title" placeholder="‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á / ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (Title)">
                            <input type="text" class="input-mini input-subject-file" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå (File Name)">
                            <div style="display:flex; gap:5px;">
                                <input type="text" class="input-mini input-subject-slide-id" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏™‡πÑ‡∏•‡∏î‡πå (Slide ID) ‡πÄ‡∏ä‡πà‡∏ô d04_v06_s04_mahakappina" style="flex:1;">
                                <button type="button" onclick="openContentSearch(this)" style="padding: 5px 10px; background-color: #f39c12;" title="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤">üîç</button>
                            </div>
                            <textarea class="input-mini input-subject-youtube" placeholder="Youtube Links (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏•‡∏∞ 1 ‡∏•‡∏¥‡∏á‡∏Å‡πå)" rows="2" style="height:auto;"></textarea>
                        </div>
                    `;
                });

                // --- Shared Zoom Link ---
                html += `
                        <div class="input-row" style="margin-top: 5px; border-top:1px solid #eee; padding-top:5px;">
                            <input type="text" class="input-mini input-zoom" placeholder="Zoom Link (‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô)" style="flex:1;">
                        </div>
                        
                        <!-- Exam Details Section -->
                        <div class="exam-details">
                            <div class="input-row" style="margin-bottom:5px;">
                                <span style="font-size:0.8em; font-weight:bold;">‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö:</span>
                                <select class="input-mini input-exam-type" style="flex:1;">
                                    ${subjects.map(s => `<option value="${s.id}">${s.label}</option>`).join('')}
                                </select>
                            </div>
                            <div class="input-row" style="margin-bottom:5px;">
                                <input type="time" class="input-mini input-exam-start" value="13:00">
                                <span style="font-size:0.8em; align-self:center;">‡∏ñ‡∏∂‡∏á</span>
                                <input type="time" class="input-mini input-exam-end" value="16:00">
                            </div>
                            <div class="input-row" style="margin-bottom:5px;">
                                <input type="text" class="input-mini input-exam-file" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö (Exam File)" style="flex:1;">
                            </div>
                            <div class="input-row">
                                <input type="text" class="input-mini input-answer-file" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏â‡∏•‡∏¢ (Answer File)" style="flex:1;">
                            </div>
                        </div>
                    </div>
                </td>`;
            });

            // Remarks Column
            html += `
                    <td>
                        <textarea class="input-mini input-remark" style="height: 100px;" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..."></textarea>
                    </td>
                </tr>
            `;
        }

        html += `</tbody></table>`;
        container.innerHTML = html;
        updateVarName();
    }

    function toggleWeekend(id) {
        const row = document.getElementById(`row-${id}`);
        const checkbox = document.getElementById(`weekend-${id}`);
        const inputs = row.querySelectorAll('input:not([id^="weekend-"]), select, textarea');

        if (checkbox.checked) {
            row.classList.add('weekend-row');
            inputs.forEach(input => input.disabled = true);
        } else {
            row.classList.remove('weekend-row');
            inputs.forEach(input => input.disabled = false);
        }
    }

    function toggleExamMode(checkbox) {
        const container = checkbox.closest('.slot-container');
        const examDetails = container.querySelector('.exam-details');
        
        if (checkbox.checked) {
            container.classList.add('is-exam-mode');
            if(examDetails) examDetails.style.display = 'block';
        } else {
            container.classList.remove('is-exam-mode');
            if(examDetails) examDetails.style.display = 'none';
        }
    }

    function generateCode() {
        const varName = document.getElementById('varName').value;
        const rows = document.querySelectorAll('.editor-table tbody tr');
        
        let code = `// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Schedule Builder V2 - Multi Subject)\n`;
        code += `var ${varName} = [\n`;

        rows.forEach(row => {
            const date = row.querySelector('.date-val').value;
            const displayDate = row.querySelector('.display-date-val').value;
            const isWeekend = row.querySelector('input[type="checkbox"][id^="weekend-"]').checked;
            
            code += `    {\n`;
            code += `        date: "${date}", displayDate: "${displayDate}",\n`;
            if (isWeekend) code += `        isWeekend: true,\n`;

            // Process Slots: Morning, Afternoon, Evening
            const periods = ['morning', 'afternoon', 'evening'];
            const cells = row.querySelectorAll('td'); // 0=Date, 1=M, 2=A, 3=E, 4=Remark

            periods.forEach((p, index) => {
                const cell = cells[index + 1]; // Offset by 1 for Date col
                const container = cell.querySelector('.slot-container');
                
                // Common Slot Fields
                const isExam = container.querySelector('.is-exam-chk').checked;
                
                // Exam Fields
                const examStart = container.querySelector('.input-exam-start').value;
                const examEnd = container.querySelector('.input-exam-end').value;
                const examFile = container.querySelector('.input-exam-file').value.trim();
                const answerFile = container.querySelector('.input-answer-file').value.trim();

                // Process Subject Sections
                const subjectSections = container.querySelectorAll('.subject-section');
                let props = [];
                let hasData = false;
                
                let allActivities = [];
                let allYoutube = [];
                let allZoom = [];

                subjectSections.forEach(section => {
                    const subjId = section.dataset.subjectId; // e.g., 'Grammar', 'Translate'
                    const act = section.querySelector('.input-subject-act').value.trim();
                    const title = section.querySelector('.input-subject-title').value.trim();
                    const file = section.querySelector('.input-subject-file').value.trim();
                    const youtubeVal = section.querySelector('.input-subject-youtube').value.trim();
                    const slideId = section.querySelector('.input-subject-slide-id').value.trim();
                    const zoomVal = section.querySelector('.input-subject-zoom').value.trim();
                    
                    if (title || file || youtubeVal || zoomVal || slideId) {
                        hasData = true;
                        
                        // 1. Build specific Activity String for this subject
                        let fullAct = act;
                        if (title) fullAct += ` : ${title}`;
                        
                        // Push to combined list
                        if (fullAct) allActivities.push(fullAct);

                        // 2. Add specific properties
                        if (fullAct) props.push(`activity${subjId}: "${fullAct}"`);
                        if (file) props.push(`fileNote${subjId}: "${file}"`);
                        if (slideId) props.push(`slideId: "${slideId}"`);
                        
                        // 3. Collect Youtube Links
                        if (youtubeVal) {
                            const links = youtubeVal.split('\n').map(l => l.trim()).filter(l => l);
                            allYoutube = allYoutube.concat(links);
                        }

                        // 4. Collect Zoom Links
                        if (zoomVal) {
                            allZoom.push(zoomVal);
                        }
                    }
                });

                // Check global slot data
                if (allZoom.length > 0 || isExam) hasData = true;

                if (hasData) {
                    // Combine Activities for fallback 'activity' field
                    if (isExam) {
                         allActivities.unshift('(‡∏™‡∏≠‡∏ö)');
                    }
                    if (allActivities.length > 0) {
                        props.push(`activity: "${allActivities.join(' / ')}"`);
                    }

                    // Youtube Array
                    if (allYoutube.length > 0) {
                        // Output as array of strings
                        const linksStr = allYoutube.map(l => `"${l}"`).join(', ');
                        props.push(`linkYoutube: [${linksStr}]`);
                    }

                    // Zoom Link (Array or String)
                    if (allZoom.length > 0) {
                        if (allZoom.length === 1) {
                            props.push(`linkZoom: "${allZoom[0]}"`);
                        } else {
                            const zLinks = allZoom.map(z => `"${z}"`).join(', ');
                            props.push(`linkZoom: [${zLinks}]`);
                        }
                    }

                    if (isExam) {
                        props.push(`isExam: true`);
                        props.push(`examStartTime: "${examStart}"`);
                        props.push(`examEndTime: "${examEnd}"`);
                        
                        // Exam Type Logic
                        const examType = container.querySelector('.input-exam-type').value;
                        if(examFile) props.push(`fileExam${examType}: "${examFile}"`);
                        if(answerFile) props.push(`fileAnswer${examType}: "${answerFile}"`);
                    }

                    code += `        ${p}: {\n            ${props.join(',\n            ')}\n        },\n`;
                }
            });

            // Remarks
            const remark = cells[4].querySelector('.input-remark').value.trim();
            if (remark) {
                code += `        remarks: { general: "${remark}" },\n`;
            }

            code += `    },\n`;
        });

        code += `];\n`;
        document.getElementById('outputCode').value = code;
    }

    function copyCode() {
        const copyText = document.getElementById("outputCode");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        document.execCommand("copy");
        alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
    }

    function downloadFile() {
        const text = document.getElementById("outputCode").value;
        if (!text) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î");
            return;
        }
        const varName = document.getElementById('varName').value;
        const filename = `${varName}.js`;

        const blob = new Blob([text], { type: "text/javascript" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    // Auth & Init
    window.onload = function() {
        const password = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (Admin Password):");
        if (password === "admin123") {
            document.querySelector('.container').style.display = 'block';
            updateRoomList();
            generateTable(); // Init with defaults
        } else {
            alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
            window.location.href = "index.html";
        }
    };
</script>

    <!-- Load Content Data for Search -->
    <script src="content-dhamma01.js"></script>
    <script src="content-dhamma02.js"></script>
    <script src="content-dhamma03.js"></script>
    <script src="content-dhamma04.js"></script>
    <script src="content-dhamma05.js"></script>
    <script src="content-dhamma06.js"></script>
    <script src="content-dhamma07.js"></script>
    <script src="content-dhamma08.js"></script>
    <script src="content-visuddhi01.js"></script>
    <script src="content-visuddhi02.js"></script>
    <script src="content-visuddhi03.js"></script>
    <script src="content-samanta01.js"></script>
    <script src="content-samanta02.js"></script>
    <script src="content-samanta03.js"></script>
    <script src="content-mangala01.js"></script>
    <script src="content-mangala02.js"></script>
    <script src="content-abhidhamma01.js"></script>

    <!-- Content Search Modal -->
    <div id="content-search-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="width: 80%; max-width: 800px; max-height: 80vh; overflow-y: auto;">
            <span class="modal-close" onclick="closeContentModal()">&times;</span>
            <h2 style="margin-top:0;">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (Slide Content)</h2>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <input type="text" id="content-search-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á, ‡∏ß‡∏£‡∏£‡∏Ñ, ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç..." style="flex:1; padding: 10px;" onkeyup="if(event.key==='Enter') performContentSearch()">
                <button onclick="performContentSearch()" class="success">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            </div>
            <div id="content-search-results"></div>
        </div>
    </div>

    <script>
        let currentSearchInput = null;

        function openContentSearch(btn) {
            currentSearchInput = btn.previousElementSibling;
            document.getElementById('content-search-modal').style.display = 'flex';
            document.getElementById('content-search-input').focus();
        }

        function closeContentModal() {
            document.getElementById('content-search-modal').style.display = 'none';
        }

        function performContentSearch() {
            const keyword = document.getElementById('content-search-input').value.trim().toLowerCase();
            if (!keyword) return;

            const resultsContainer = document.getElementById('content-search-results');
            resultsContainer.innerHTML = '<p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...</p>';
            
            const results = [];
            
            // Iterate over all global variables starting with 'content'
            for (const key in window) {
                if (key.startsWith('content') && typeof window[key] === 'object') {
                    const contentObj = window[key];
                    for (const id in contentObj) {
                        const items = contentObj[id];
                        if (Array.isArray(items) && items.length > 0) {
                            // Check first item usually contains metadata
                            const item = items[0];
                            let match = false;
                            
                            if (id.toLowerCase().includes(keyword)) match = true;
                            if (item.story && item.story.toLowerCase().includes(keyword)) match = true;
                            if (item.vagga && item.vagga.toLowerCase().includes(keyword)) match = true;
                            if (item.part && item.part.toLowerCase().includes(keyword)) match = true;
                            
                            if (match) {
                                results.push({
                                    id: id,
                                    story: item.story || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á',
                                    vagga: item.vagga || '',
                                    part: item.part || ''
                                });
                            }
                        }
                    }
                }
            }

            if (results.length === 0) {
                resultsContainer.innerHTML = '<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
                return;
            }

            let html = '';
            results.forEach(r => {
                html += `
                    <div class="search-result-item" onclick="selectContent('${r.id}', '${r.story.replace(/'/g, "\\'")}')">
                        <strong>${r.story}</strong>
                        <small>ID: ${r.id} | ${r.vagga} | ${r.part}</small>
                    </div>
                `;
            });
            resultsContainer.innerHTML = html;
        }

        function selectContent(id, title) {
            if (currentSearchInput) {
                currentSearchInput.value = id;
                
                // Try to auto-fill Title if empty
                const container = currentSearchInput.closest('.subject-section');
                if (container) {
                    const titleInput = container.querySelector('.input-subject-title');
                    if (titleInput && !titleInput.value) {
                        titleInput.value = title;
                    }
                }
                
                closeContentModal();
            }
        }
    </script>
</body>
</html>
