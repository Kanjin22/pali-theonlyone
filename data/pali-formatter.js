// PaliFormatter: Centralized logic for formatting dictionary definitions
// Designed to be portable across projects (e.g., Pali TheOnlyOne, theDhatu)

const PaliFormatter = {
    // Configuration for Grammatical Terms (User can add more here)
    GRAMMAR_TERMS: {
        samasa: [ // สมาส (Compounds)
            // ชื่อเต็ม
            "วิเสสนบุพพบท กัมมธารยสมาส",
            "วิเสสนุตตรบท กัมมธารยสมาส",
            "วิเสสโนภยบท กัมมธารยสมาส",
            "อุปมาบุพพบท วิเสสโนปมบท กัมมธารยสมาส",
            "อุปมานุตตรบท วิเสสโนปมบท กัมมธารยสมาส",
            "สัมภาวนบุพพบท กัมมธารยสมาส",
            "อวธารณบุพพบท กัมมธารยสมาส",
            "นบุพพบท กัมมธารยสมาส",
            "อุภยตัปปุริสสมาส",
            "สมาหาร ทิคุสมาส",
            "อสมาหาร ทิคุสมาส",
            "ทุติยาตัปปุริสสมาส",
            "ตติยาตัปปุริสสมาส",
            "จตุตถีตัปปุริสสมาส",
            "ปัญจมีตัปปุริสสมาส",
            "ฉัฏฐีตัปปุริสสมาส",
            "สัตตมีตัปปุริสสมาส",
            "สมาหาร ทวันทวสมาส",
            "อสมาหาร ทวันทวสมาส",
            "อุปสัคคปุพพก อัพยยีภาวสมาส",
            "นิปาตปุพพก อัพยยีภาวสมาส",
            "ทุติยาตุลยาธิกรณพหุพพิหิสมาส",
            "ตติยาตุลยาธิกรณพหุพพิหิสมาส",
            "จตุตถีตุลยาธิกรณพหุพพิหิสมาส",
            "ปัญจมีตุลยาธิกรณพหุพพิหิสมาส",
            "ฉัฏฐีตุลยาธิกรณพหุพพิหิสมาส",
            "สัตตมีตุลยาธิกรณพหุพพิหิสมาส",
            "ภินนาธิกรณพหุพพิหิสมาส",
            "ฉัฏฐีอุปมาพหุพพิหิสมาส",
            "นบุพพบทพหุพพิหิสมาส",
            "สหบุพพบทพหุพพิหิสมาส",

            // ชื่อสมาสหลัก
            "กัมมธารยสมาส",
            "ทิคุสมาส",
            "ตัปปุริสสมาส",
            "อัพยยีภาวสมาส",
            "ทวันทวสมาส",
            "พหุพพิหิสมาส",

            // ชื่อย่อยสมาส
            "วิเสสนบุพพบท",
            "วิเสสนุตตรบท",
            "วิเสสโนภยบท",
            "อุปมาบุพพบท วิเสสโนปมบท",
            "อุปมานุตตรบท วิเสสโนปมบท",
            "สัมภาวนบุพพบท",
            "อวธารณบุพพบท",
            "นบุพพบท",
            "อุภย",
            "สมาหาร",
            "อสมาหาร",
            "ทุติยา",
            "ตติยา",
            "จตุตถี",
            "ปัญจมี",
            "ฉัฏฐี",
            "สัตตมี",
            "อุปสัคคปุพพก",
            "นิปาตปุพพก",
            "ทุติยาตุลยาธิกรณ",
            "ตติยาตุลยาธิกรณ",
            "จตุตถีตุลยาธิกรณ",
            "ปัญจมีตุลยาธิกรณ",
            "ฉัฏฐีตุลยาธิกรณ",
            "สัตตมีตุลยาธิกรณ",
            "ภินนาธิกรณ",
            "ฉัฏฐีอุปมา",
            "สหบุพพบท"
        ],
        taddhita: [ // ตัทธิต (Derivatives)
            // ชื่อตัทธิต
            "ภาวตัทธิต",
            "อัพยยตัทธิต",
            "โคตตตัทธิต",
            "ตรัตยาทิตัทธิต",
            "ราคาทิตัทธิต",
            "ชาตาทิตัทธิต",
            "สมุหตัทธิต",
            "ฐานตัทธิต",
            "พหุลตัทธิต",
            "เสฏฐตัทธิต",
            "ตทัสสัตถิตัทธิต",
            "ปกติตัทธิต",
            "สังขยาตัทธิต",
            "ปูรณตัทธิต",
            "วิภาคตัทธิต",
            "อุปมาตัทธิต",
            "นิสสิตตัทธิต",

            // ชื่อปัจจัยในตัทธิต
            "ณ ปัจจัย ในโคตตตัทธิต",
            "ณายน ปัจจัย ในโคตตตัทธิต",
            "ณาน ปัจจัย ในโคตตตัทธิต",
            "เณยฺย ปัจจัย ในโคตตตัทธิต",
            "ณิ ปัจจัย ในโคตตตัทธิต",
            "ณิก ปัจจัย ในโคตตตัทธิต",
            "ณว ปัจจัย ในโคตตตัทธิต",
            "เณร ปัจจัย ในโคตตตัทธิต",
            "ณ ปัจจัย ในตรัตยาทิตัทธิต",
            "อิม ปัจจัย ในชาตาทิตัทธิต",
            "อิย ปัจจัย ในชาตาทิตัทธิต",
            "กิย ปัจจัย ในชาตาทิตัทธิต",
            "กณฺ ปัจจัย ในสมุหตัทธิต",
            "ณ ปัจจัย ในสมุหตัทธิต",
            "ตา ปัจจัย ในสมุหตัทธิต",
            "อีย ปัจจัย ในฐานตัทธิต",
            "เอยฺย ปัจจัย ในฐานตัทธิต",
            "อาลุ ปัจจัย ในพหุลตัทธิต",
            "ตร ปัจจัย ในเสฏฐตัทธิต",
            "ตม ปัจจัย ในเสฏฐตัทธิต",
            "อิยิสฺสก ปัจจัย ในเสฏฐตัทธิต",
            "อิย ปัจจัย ในเสฏฐตัทธิต",
            "อิฏฺฐ ปัจจัย ในเสฏฐตัทธิต",
            "วี ปัจจัย ในตทัสสัตถิตัทธิต",
            "ส ปัจจัย ในตทัสสัตถิตัทธิต",
            "สี ปัจจัย ในตทัสสัตถิตัทธิต",
            "อิก ปัจจัย ในตทัสสัตถิตัทธิต",
            "อี ปัจจัย ในตทัสสัตถิตัทธิต",
            "ร ปัจจัย ในตทัสสัตถิตัทธิต",
            "วนฺตุ ปัจจัย ในตทัสสัตถิตัทธิต",
            "มนฺตุ ปัจจัย ในตทัสสัตถิตัทธิต",
            "ณ ปัจจัย ในตทัสสัตถิตัทธิต",
            "มย ปัจจัย ในปกติตัทธิต",
            "ติย ปัจจัย ในปูรณตัทธิต",
            "ถ ปัจจัย ในปูรณตัทธิต",
            "ฐ ปัจจัย ในปูรณตัทธิต",
            "ม ปัจจัย ในปูรณตัทธิต",
            "อี ปัจจัย ในปูรณตัทธิต",
            "ก ปัจจัย ในสังขยาตัทธิต",
            "ธา ปัจจัย ในวิภาคตัทธิต",
            "โส ปัจจัย ในวิภาคตัทธิต",
            "ตฺต ปัจจัย ในภาวตัทธิต",
            "ณฺย ปัจจัย ในภาวตัทธิต",
            "ตฺตน ปัจจัย ในภาวตัทธิต",
            "ตา ปัจจัย ในภาวตัทธิต",
            "ณ ปัจจัย ในภาวตัทธิต",
            "กณฺ ปัจจัย ในภาวตัทธิต",
            "ถา ปัจจัย ในอัพยยตัทธิต",
            "ถํ ปัจจัย ในอัพยยตัทธิต",
            "อิยิตตฺต ปัจจัย ในอุปมาตัทธิต",
            "ล ปัจจัย ในนิสสิตตัทธิต"
        ],
        kitaka: [ // นามกิตก์ / กิริยากิตก์ (Verbal Derivatives)
            "นามกิตก์",
            "กิริยากิตก์",
            "กิตก์"
        ],
        vibhatti: [ // วิภัตตินาม (Noun Declensions)
            // คำเต็ม
            "ปฐมาวิภัตติ ฝ่ายเอกวจนะ",
            "ปฐมาวิภัตติ ฝ่ายพหุวจนะ",
            "ทุติยาวิภัตติ ฝ่ายเอกวจนะ",
            "ทุติยาวิภัตติ ฝ่ายพหุวจนะ",
            "ตติยาวิภัตติ ฝ่ายเอกวจนะ",
            "ตติยาวิภัตติ ฝ่ายพหุวจนะ",
            "จตุตถีวิภัตติ ฝ่ายเอกวจนะ",
            "จตุตถีวิภัตติ ฝ่ายพหุวจนะ",
            "ปัญจมีวิภัตติ ฝ่ายเอกวจนะ",
            "ปัญจมีวิภัตติ ฝ่ายพหุวจนะ",
            "ฉัฏฐีวิภัตติ ฝ่ายเอกวจนะ",
            "ฉัฏฐีวิภัตติ ฝ่ายพหุวจนะ",
            "สัตตมีวิภัตติ ฝ่ายเอกวจนะ",
            "สัตตมีวิภัตติ ฝ่ายพหุวจนะ",
            "อาลปนวิภัตติ ฝ่ายเอกวจนะ",
            "อาลปนวิภัตติ ฝ่ายพหุวจนะ",
            
            // อักษรย่อ
            "ป.เอก.",
            "ป.พหุ.",
            "ทุ.เอก.",
            "ทุ.พหุ.",
            "ต.เอก.",
            "ต.พหุ.",
            "จ.เอก.",
            "จ.พหุ.",
            "ปญฺ.เอก.",
            "ปญฺ.พหุ.",
            "ฉ.เอก.",
            "ฉ.พหุ.",
            "ส.เอก.",
            "ส.พหุ.",
            "อา.เอก.",
            "อา.พหุ.",
            
            // คำเต็มวิภัตติ
            "สิ ปฐมาวิภัตติ ฝ่ายเอกวจนะ",
            "โย ปฐมาวิภัตติ ฝ่ายพหุวจนะ",
            "อํ ทุติยาวิภัตติ ฝ่ายเอกวจนะ",
            "โย ทุติยาวิภัตติ ฝ่ายพหุวจนะ",
            "นา ตติยาวิภัตติ ฝ่ายเอกวจนะ",
            "หิ ตติยาวิภัตติ ฝ่ายพหุวจนะ",
            "ส จตุตถีวิภัตติ ฝ่ายเอกวจนะ",
            "นํ จตุตถีวิภัตติ ฝ่ายพหุวจนะ",
            "สฺมา ปัญจมีวิภัตติ ฝ่ายเอกวจนะ",
            "หิ ปัญจมีวิภัตติ ฝ่ายพหุวจนะ",
            "ส ฉัฏฐีวิภัตติ ฝ่ายเอกวจนะ",
            "นํ ฉัฏฐีวิภัตติ ฝ่ายพหุวจนะ",
            "สฺมึ สัตตมีวิภัตติ ฝ่ายเอกวจนะ",
            "สุ สัตตมีวิภัตติ ฝ่ายพหุวจนะ",
            "สิ อาลปนวิภัตติ ฝ่ายเอกวจนะ",
            "โย อาลปนวิภัตติ ฝ่ายพหุวจนะ",
            
            // อักษรย่อวิภัตติ
            "สิ ป.เอก.",
            "โย ป.พหุ.",
            "อํ ทุ.เอก.",
            "โย ทุ.พหุ.",
            "นา ต.เอก.",
            "หิ ต.พหุ.",
            "ส จ.เอก.",
            "นํ จ.พหุ.",
            "สฺมา ปญฺ.เอก.",
            "หิ ปญฺ.พหุ.",
            "ส ฉ.เอก.",
            "นํ ฉ.พหุ.",
            "สฺมึ ส.เอก.",
            "สุ ส.พหุ.",
            "สิ อา.เอก.",
            "โย อา.พหุ."
        ],
        vacaka: [ // วาจก (Voice)
            // ชื่อเรียก
            "กัตตุวาจก",
            "กัมมวาจก",
            "ภาววาจก",
            "เหตุกัตตุวาจก",
            "เหตุกัมมวาจก",

            // อักษรย่อ
            "กัตตุ.",
            "กัมม.",
            "ภาว.",
            "เหตุกัตตุ.",
            "เหตุกัมม."
        ],
        akhyataPaccaya: [ // ปัจจัยในอาขยาต (Verb Suffixes)
            // ปัจจัย
            "อ ปัจจัย",
            "อิ ปัจจัย",
            "อี ปัจจัย",
            "เอ ปัจจัย",
            "โอ ปัจจัย",
            "ย ปัจจัย",
            "ณุ ปัจจัย",
            "ณา ปัจจัย",
            "อุณา ปัจจัย",
            "นา ปัจจัย",
            "ปฺป ปัจจัย",
            "ณฺหา ปัจจัย",
            "โอ ปัจจัย",
            "ยิร ปัจจัย",
            "เณ ปัจจัย",
            "ณย ปัจจัย",
            "ย ปัจจัย",
            "ย ปัจจัย",
            "เณ ปัจจัย",
            "ณย ปัจจัย",
            "ณาเป ปัจจัย",
            "ณาปย ปัจจัย",
            
            // ชื่อเรียกคู่กับวิภัตติ
            "อ ปัจจัย ในกัตตุวาจก",
            "อิ ปัจจัย ในกัตตุวาจก",
            "อี ปัจจัย ในกัตตุวาจก",
            "เอ ปัจจัย ในกัตตุวาจก",
            "โอ ปัจจัย ในกัตตุวาจก",
            "ย ปัจจัย ในกัตตุวาจก",
            "ณุ ปัจจัย ในกัตตุวาจก",
            "ณา ปัจจัย ในกัตตุวาจก",
            "อุณา ปัจจัย ในกัตตุวาจก",
            "นา ปัจจัย ในกัตตุวาจก",
            "ปฺป ปัจจัย ในกัตตุวาจก",
            "ณฺหา ปัจจัย ในกัตตุวาจก",
            "โอ ปัจจัย ในกัตตุวาจก",
            "ยิร ปัจจัย ในกัตตุวาจก",
            "เณ ปัจจัย ในกัตตุวาจก",
            "ณย ปัจจัย ในกัตตุวาจก",
            "ย ปัจจัย ในกัมมวาจก",
            "ย ปัจจัย ในภาววาจก",
            "เณ ปัจจัย ในเหตุกัตตุวาจก",
            "ณย ปัจจัย ในเหตุกัตตุวาจก",
            "ณาเป ปัจจัย ในเหตุกัตตุวาจก",
            "ณาปย ปัจจัย ในเหตุกัตตุวาจก",
            
            // ชื่อเรียกกรณีเน้นหมวดธาตุ
            "อ ปัจจัยประจำหมวดธาตุ",
            "อิ ปัจจัยประจำหมวดธาตุ",
            "อี ปัจจัยประจำหมวดธาตุ",
            "เอ ปัจจัยประจำหมวดธาตุ",
            "โอ ปัจจัยประจำหมวดธาตุ",
            "ย ปัจจัยประจำหมวดธาตุ",
            "ณุ ปัจจัยประจำหมวดธาตุ",
            "ณา ปัจจัยประจำหมวดธาตุ",
            "อุณา ปัจจัยประจำหมวดธาตุ",
            "นา ปัจจัยประจำหมวดธาตุ",
            "ปฺป ปัจจัยประจำหมวดธาตุ",
            "ณฺหา ปัจจัยประจำหมวดธาตุ",
            "โอ ปัจจัยประจำหมวดธาตุ",
            "ยิร ปัจจัยประจำหมวดธาตุ",
            "เณ ปัจจัยประจำหมวดธาตุ",
            "ณย ปัจจัยประจำหมวดธาตุ"
        ],
        akhyataVibhatti: [ // วิภัตติอาขยาต (Verb Declensions)
            // ชื่อหมวดวิภัตติ
            "วัตตมานาวิภัตติ",
            "ปัญจมีวิภัตติ",
            "สัตตมีวิภัตติ",
            "ปโรกขาวิภัตติ",
            "หิยัตตนีวิภัตติ",
            "อัชชัตตนีวิภัตติ",
            "ภวิสสันติวิภัตติ",
            "กาลาติปัตติวิภัตติ",

            // อักษรย่อหมวดวิภัตติ
            "วตฺ.",
            "ปญฺ.",
            "สตฺ.",
            "ปโร.",
            "หิย.",
            "อชฺ.",
            "ภวิ.",
            "กาลา.",

            // วิภัตติ 96 ตัว พร้อมชื่อหมวด
            "ติ วัตตมานาวิภัตติ", "อนฺติ วัตตมานาวิภัตติ", "สิ วัตตมานาวิภัตติ", "ถ วัตตมานาวิภัตติ", "มิ วัตตมานาวิภัตติ", "มิ วัตตมานาวิภัตติ",
            "เต วัตตมานาวิภัตติ", "อนฺเต วัตตมานาวิภัตติ", "เส วัตตมานาวิภัตติ", "วฺเห วัตตมานาวิภัตติ", "เอ วัตตมานาวิภัตติ", "มฺเห วัตตมานาวิภัตติ",
            "ตุ ปัญจมีวิภัตติ", "อนฺตุ ปัญจมีวิภัตติ", "หิ ปัญจมีวิภัตติ", "ถ ปัญจมีวิภัตติ", "มิ ปัญจมีวิภัตติ", "ม ปัญจมีวิภัตติ",
            "ตํ ปัญจมีวิภัตติ", "อนฺตํ ปัญจมีวิภัตติ", "สฺสุ ปัญจมีวิภัตติ", "วฺโห ปัญจมีวิภัตติ", "เอ ปัญจมีวิภัตติ", "อามฺหเส ปัญจมีวิภัตติ",
            "เอยฺย สัตตมีวิภัตติ", "เอยฺยํ สัตตมีวิภัตติ", "เอยฺยาสิ สัตตมีวิภัตติ", "เอยฺยาถ สัตตมีวิภัตติ", "เอยฺยามิ สัตตมีวิภัตติ", "เอยฺยาม สัตตมีวิภัตติ",
            "เอถ สัตตมีวิภัตติ", "เอรํ สัตตมีวิภัตติ", "เอโถ สัตตมีวิภัตติ", "เอยฺยวฺโห สัตตมีวิภัตติ", "เอยฺยํ สัตตมีวิภัตติ", "เอยฺยามฺเห สัตตมีวิภัตติ",
            "อ ปโรกขาวิภัตติ", "อุ ปโรกขาวิภัตติ", "เอ ปโรกขาวิภัตติ", "ตฺถ ปโรกขาวิภัตติ", "อํ ปโรกขาวิภัตติ", "มฺห ปโรกขาวิภัตติ",
            "ตฺถ ปโรกขาวิภัตติ", "เร ปโรกขาวิภัตติ", "ตฺโถ ปโรกขาวิภัตติ", "วฺโห ปโรกขาวิภัตติ", "อึ ปโรกขาวิภัตติ", "มฺเห ปโรกขาวิภัตติ",
            "อา หิยัตตนีวิภัตติ", "อู หิยัตตนีวิภัตติ", "โอ หิยัตตนีวิภัตติ", "ตฺถ หิยัตตนีวิภัตติ", "อํ หิยัตตนีวิภัตติ", "มฺห หิยัตตนีวิภัตติ",
            "ตฺถ หิยัตตนีวิภัตติ", "ตฺถํ หิยัตตนีวิภัตติ", "เส หิยัตตนีวิภัตติ", "วฺหํ หิยัตตนีวิภัตติ", "อึ หิยัตตนีวิภัตติ", "มฺหเส หิยัตตนีวิภัตติ",
            "อี อัชชัตตนีวิภัตติ", "อํ อัชชัตตนีวิภัตติ", "โอ อัชชัตตนีวิภัตติ", "ตฺถ อัชชัตตนีวิภัตติ", "อึ อัชชัตตนีวิภัตติ", "มฺหา อัชชัตตนีวิภัตติ",
            "อา อัชชัตตนีวิภัตติ", "อู อัชชัตตนีวิภัตติ", "เส อัชชัตตนีวิภัตติ", "วฺหํ อัชชัตตนีวิภัตติ", "อํ อัชชัตตนีวิภัตติ", "มฺเห อัชชัตตนีวิภัตติ",
            "สฺสติ ภวิสสันติวิภัตติ", "สฺสนฺติ ภวิสสันติวิภัตติ", "สฺสสิ ภวิสสันติวิภัตติ", "สฺสถ ภวิสสันติวิภัตติ", "สฺสามิ ภวิสสันติวิภัตติ", "สฺสาม ภวิสสันติวิภัตติ",
            "สฺสเต ภวิสสันติวิภัตติ", "สฺสนฺเต ภวิสสันติวิภัตติ", "สฺสเส ภวิสสันติวิภัตติ", "สฺสวฺเห ภวิสสันติวิภัตติ", "สฺสํ ภวิสสันติวิภัตติ", "สฺสามฺเห ภวิสสันติวิภัตติ",
            "สฺสา กาลาติปัตติวิภัตติ", "สฺสํสุ กาลาติปัตติวิภัตติ", "สฺเส กาลาติปัตติวิภัตติ", "สฺสถ กาลาติปัตติวิภัตติ", "สฺสํ กาลาติปัตติวิภัตติ", "สฺสามฺหา กาลาติปัตติวิภัตติ",
            "สฺสถ กาลาติปัตติวิภัตติ", "สฺสึสุ กาลาติปัตติวิภัตติ", "สฺสเส กาลาติปัตติวิภัตติ", "สฺสวฺเห กาลาติปัตติวิภัตติ", "สฺสํ กาลาติปัตติวิภัตติ", "สฺสามฺหเส กาลาติปัตติวิภัตติ"
        ],
        rupaSadhana: [ // รูปและสาธารณะในนามกิตก์ (Form and Voice in Verbal Derivatives)
            // รูปและสาธนะทั่วไป
            "กัตตุรูป กัตตุสาธนะ",
            "กัตตุรูป กัมมสาธนะ",
            "กัตตุรูป ภาวสาธนะ",
            "กัตตุรูป กรณสาธนะ",
            "กัตตุรูป สัมปทานสาธนะ",
            "กัตตุรูป อปาทานสาธนะ",
            "กัตตุรูป อธิกรณสาธนะ",
            "กัมมรูป กัตตุสาธนะ",
            "กัมมรูป กัมมสาธนะ",
            "กัมมรูป ภาวสาธนะ",
            "กัมมรูป กรณสาธนะ",
            "กัมมรูป สัมปทานสาธนะ",
            "กัมมรูป อปาทานสาธนะ",
            "กัมมรูป อธิกรณสาธนะ",
            "ภาวรูป กัตตุสาธนะ",
            "ภาวรูป กัมมสาธนะ",
            "ภาวรูป ภาวสาธนะ",
            "ภาวรูป กรณสาธนะ",
            "ภาวรูป สัมปทานสาธนะ",
            "ภาวรูป อปาทานสาธนะ",
            "ภาวรูป อธิกรณสาธนะ",
            "สมาสรูป กัตตุสาธนะ",
            "สมาสรูป กัมมสาธนะ",
            "สมาสรูป ภาวสาธนะ",
            "สมาสรูป กรณสาธนะ",
            "สมาสรูป สัมปทานสาธนะ",
            "สมาสรูป อปาทานสาธนะ",
            "สมาสรูป อธิกรณสาธนะ",
            "สมาสรูป ตัสสีลสาธนะ",


            // ลงในอรรถแห่งตัสสีละ
            "กัตตุรูป กัตตุสาธนะ ลงในอรรถแห่งตัสสีละ",
            "กัตตุรูป กัมมสาธนะ ลงในอรรถแห่งตัสสีละ",
            "กัตตุรูป ภาวสาธนะ ลงในอรรถแห่งตัสสีละ",
            "กัตตุรูป กรณสาธนะ ลงในอรรถแห่งตัสสีละ",
            "กัตตุรูป สัมปทานสาธนะ ลงในอรรถแห่งตัสสีละ",
            "กัตตุรูป อปาทานสาธนะ ลงในอรรถแห่งตัสสีละ",
            "กัตตุรูป อธิกรณสาธนะ ลงในอรรถแห่งตัสสีละ",
            "กัมมรูป กัตตุสาธนะ ลงในอรรถแห่งตัสสีละ",
            "กัมมรูป กัมมสาธนะ ลงในอรรถแห่งตัสสีละ",
            "กัมมรูป ภาวสาธนะ ลงในอรรถแห่งตัสสีละ",
            "กัมมรูป กรณสาธนะ ลงในอรรถแห่งตัสสีละ",
            "กัมมรูป สัมปทานสาธนะ ลงในอรรถแห่งตัสสีละ",
            "กัมมรูป อปาทานสาธนะ ลงในอรรถแห่งตัสสีละ",
            "กัมมรูป อธิกรณสาธนะ ลงในอรรถแห่งตัสสีละ",
            "ภาวรูป กัตตุสาธนะ ลงในอรรถแห่งตัสสีละ",
            "ภาวรูป กัมมสาธนะ ลงในอรรถแห่งตัสสีละ",
            "ภาวรูป ภาวสาธนะ ลงในอรรถแห่งตัสสีละ",
            "ภาวรูป กรณสาธนะ ลงในอรรถแห่งตัสสีละ",
            "ภาวรูป สัมปทานสาธนะ ลงในอรรถแห่งตัสสีละ",
            "ภาวรูป อปาทานสาธนะ ลงในอรรถแห่งตัสสีละ",
            "ภาวรูป อธิกรณสาธนะ ลงในอรรถแห่งตัสสีละ",
            "สมาสรูป กัตตุสาธนะ ลงในอรรถแห่งตัสสีละ",
            "สมาสรูป กัมมสาธนะ ลงในอรรถแห่งตัสสีละ",
            "สมาสรูป ภาวสาธนะ ลงในอรรถแห่งตัสสีละ",
            "สมาสรูป กรณสาธนะ ลงในอรรถแห่งตัสสีละ",
            "สมาสรูป สัมปทานสาธนะ ลงในอรรถแห่งตัสสีละ",
            "สมาสรูป อปาทานสาธนะ ลงในอรรถแห่งตัสสีละ",
            "สมาสรูป อธิกรณสาธนะ ลงในอรรถแห่งตัสสีละ",

            // อักษรย่อรูปและสาธนะ
            "กัตตุ.กัตตุ.",
            "กัตตุ.กัมม.",
            "กัตตุ.ภาว.",
            "กัตตุ.กรณ.",
            "กัตตุ.สัมปทาน.",
            "กัตตุ.อปาทาน.",
            "กัตตุ.อธิกรณ.",
            "กัมม.กัตตุ.",
            "กัมม.กัมม.",
            "กัมม.ภาว.",
            "กัมม.กรณ.",
            "กัมม.สัมปทาน.",
            "กัมม.อปาทาน.",
            "กัมม.อธิกรณ.",
            "ภาว.กัตตุ.",
            "ภาว.กัมม.",
            "ภาว.ภาว.",
            "ภาว.กรณ.",
            "ภาว.สัมปทาน.",
            "ภาว.อปาทาน.",
            "ภาว.อธิกรณ.",
            "สมาส.กัตตุ.",
            "สมาส.กัมม.",
            "สมาส.ภาว.",
            "สมาส.กรณ.",
            "สมาส.สัมปทาน.",
            "สมาส.อปาทาน.",
            "สมาส.อธิกรณ.",
            "สมาส.ตัส.",

            // อักษรย่อลงในอรรถแห่งตัสสีล
            "กัตตุ.กัตตุ. ตัส.",
            "กัตตุ.กัมม. ตัส.",
            "กัตตุ.ภาว. ตัส.",
            "กัตตุ.กรณ. ตัส.",
            "กัตตุ.สัมปทาน. ตัส.",
            "กัตตุ.อปาทาน. ตัส.",
            "กัตตุ.อธิกรณ. ตัส.",
            "กัมม.กัตตุ. ตัส.",
            "กัมม.กัมม. ตัส.",
            "กัมม.ภาว. ตัส.",
            "กัมม.กรณ. ตัส.",
            "กัมม.สัมปทาน. ตัส.",
            "กัมม.อปาทาน. ตัส.",
            "กัมม.อธิกรณ. ตัส.",
            "ภาว.กัตตุ. ตัส.",
            "ภาว.กัมม. ตัส.",
            "ภาว.ภาว. ตัส.",
            "ภาว.กรณ. ตัส.",
            "ภาว.สัมปทาน. ตัส.",
            "ภาว.อปาทาน. ตัส.",
            "ภาว.อธิกรณ. ตัส.",
            "สมาส.กัตตุ. ตัส.",
            "สมาส.กัมม. ตัส.",
            "สมาส.ภาว. ตัส.",
            "สมาส.กรณ. ตัส.",
            "สมาส.สัมปทาน. ตัส.",
            "สมาส.อปาทาน. ตัส.",
            "สมาส.อธิกรณ. ตัส.",
            "สมาส.ตัส. ตัส."
        ],
        namaKitakaPaccaya: [ // ปัจจัยในนามกิตก์ (Suffixes in Noun Derivatives)
            "กฺวิ ปัจจัย",
            "ณี ปัจจัย",
            "ณฺวุ ปัจจัย",
            "ตุ ปัจจัย",
            "รู ปัจจัย",
            "ข ปัจจัย",
            "ณย ปัจจัย",
            "ริจฺจ ปัจจัย",
            "อ ปัจจัย",
            "อิ ปัจจัย",
            "ณ ปัจจัย",
            "ตเว ปัจจัย",
            "ติ ปัจจัย",
            "ตุํ ปัจจัย",
            "ยุ ปัจจัย",
            "อาวี ปัจจัย",
            "รตฺถุ ปัจจัย",
            "ริตุ ปัจจัย",
            "ราตุ ปัจจัย",
            "รมฺม ปัจจัย",
            "ณฺก ปัจจัย",
            "ร ปัจจัย",
            "ริริย ปัจจัย",
            "ต ปัจจัย",
            "อิน ปัจจัย",
            "ตุก ปัจจัย",
            "อิก ปัจจัย",
            "การ ปัจจัย"
        ],
        kiriyaKitakaPaccaya: [ // ปัจจัยในกิริยากิตก์ (Suffixes in Verbal Derivatives)
            // ปัจจัยล้วน
            "อนฺต ปัจจัย",
            "ตวนฺตุ ปัจจัย",
            "ตาวี ปัจจัย",
            "ตุ ปัจจัย",
            "อนีย ปัจจัย",
            "ตพฺพ ปัจจัย",
            "มาน ปัจจัย",
            "ต ปัจจัย",
            "ตูน ปัจจัย",
            "ตฺวา ปัจจัย",
            "ตฺวาน ปัจจัย",

            // ปัจจัย + วาจก
            "อนฺต ปัจจัย เป็นกัตตุวาจก", "อนฺต ปัจจัย เป็นเหตุกัตตุวาจก",
            "ตวนฺตุ ปัจจัย เป็นกัตตุวาจก", "ตวนฺตุ ปัจจัย เป็นเหตุกัตตุวาจก",
            "ตาวี ปัจจัย เป็นกัตตุวาจก", "ตาวี ปัจจัย เป็นเหตุกัตตุวาจก",
            "ตุ ปัจจัย เป็นกัตตุวาจก", "ตุ ปัจจัย เป็นเหตุกัตตุวาจก",
            
            "อนีย ปัจจัย เป็นกัมมวาจก", "อนีย ปัจจัย เป็นภาววาจก", "อนีย ปัจจัย เป็นเหตุกัมมวาจก",
            "ตพฺพ ปัจจัย เป็นกัมมวาจก", "ตพฺพ ปัจจัย เป็นภาววาจก", "ตพฺพ ปัจจัย เป็นเหตุกัมมวาจก",
            
            "มาน ปัจจัย เป็นกัตตุวาจก", "มาน ปัจจัย เป็นกัมมวาจก", "มาน ปัจจัย เป็นภาววาจก", "มาน ปัจจัย เป็นเหตุกัตตุวาจก", "มาน ปัจจัย เป็นเหตุกัมมวาจก",
            "ต ปัจจัย เป็นกัตตุวาจก", "ต ปัจจัย เป็นกัมมวาจก", "ต ปัจจัย เป็นภาววาจก", "ต ปัจจัย เป็นเหตุกัตตุวาจก", "ต ปัจจัย เป็นเหตุกัมมวาจก",
            "ตูน ปัจจัย เป็นกัตตุวาจก", "ตูน ปัจจัย เป็นกัมมวาจก", "ตูน ปัจจัย เป็นภาววาจก", "ตูน ปัจจัย เป็นเหตุกัตตุวาจก", "ตูน ปัจจัย เป็นเหตุกัมมวาจก",
            "ตฺวา ปัจจัย เป็นกัตตุวาจก", "ตฺวา ปัจจัย เป็นกัมมวาจก", "ตฺวา ปัจจัย เป็นภาววาจก", "ตฺวา ปัจจัย เป็นเหตุกัตตุวาจก", "ตฺวา ปัจจัย เป็นเหตุกัมมวาจก",
            "ตฺวาน ปัจจัย เป็นกัตตุวาจก", "ตฺวาน ปัจจัย เป็นกัมมวาจก", "ตฺวาน ปัจจัย เป็นภาววาจก", "ตฺวาน ปัจจัย เป็นเหตุกัตตุวาจก", "ตฺวาน ปัจจัย เป็นเหตุกัมมวาจก"
        ]
    },

    /**
     * Formats dictionary definition text with styling and links.
     * @param {string|Array|Object} text - The raw definition text.
     * @param {string} callbackName - The global function name to call when clicking a link (default: 'showDictionaryDefinition').
     * @returns {string} The formatted HTML string.
     */
    format: function(text, callbackName = 'showDictionaryDefinition') {
        if (!text) return "";
        
        // Handle non-string inputs
        if (typeof text !== 'string') {
            if (Array.isArray(text)) return text.map(t => this.format(t, callbackName)).join('<br>');
            if (typeof text === 'object') return JSON.stringify(text);
            text = String(text);
        }

        // 1. Normalize Newlines: Convert \n to <br> and collapse multiple <br>
        let clean = text.replace(/(\r\n|\n|\r)+/g, '<br>'); 
        clean = clean.replace(/(<br\s*\/?>\s*){2,}/gi, '<br>');

        // 2. Normalize Spaces: Collapse multiple spaces to single space
        clean = clean.replace(/[ \t]{2,}/g, ' ');

        // 2.2 Fix Noun + Gender line break (remove break after น.,)
        clean = clean.replace(/(น\.,)\s*<br\s*\/?>\s*/g, '$1 ');

        // 2.3 Verb Definition Formatting (Word + ก.)
        // Handle "Word ก." or just "ก." at start of definition or line
        clean = clean.replace(/(^|>|\s)([ก-๙ฺ\.]+\s+)?(ก\.)(\s)/g, (match, prefix, word, type, space) => {
            let res = prefix || '';
            if (word) {
                res += `<span style="color:#d35400; font-weight:bold;">${word.trim()}</span> `;
            }
            res += `<span style="color:#16a085; font-weight:bold;">${type.trim()}</span>${space}`;
            return res;
        });

        // 2.5 Link "See also" (ดู ..., เทียบ ...)
        // Wraps words following "ดู" or "เทียบ" in a clickable span that calls the callback function
        clean = clean.replace(/(^|\s|>)((?:ดู|เทียบ)\s+)([ก-๙\u0E00-\u0E7F]+)/g, 
            `$1$2<span style="color:#3498db; cursor:pointer; text-decoration:underline;" onclick="${callbackName}('$3')">$3</span>`);

        // 3. Formatting (Beauty): Add breaks/styling for key sections
        
        // 3.0 Pre-formatting fixes
        // Break after "แจกได้ใน X ลิงค์" 
        clean = clean.replace(/(แจกได้ใน\s*[๐-๙]+\s*ลิงค์)/g, '$1<br>');

        // 3.0.5 Etymology (มาจาก...) -> New Line + Gray Bold
        // If "มาจาก" is present, format it.
        clean = clean.replace(/(มาจาก)/g, '<br><span style="color:#7f8c8d; font-weight:bold;">$1</span>');

        // If "มาจาก" is MISSING but we detect "[Word] ธาตุ" pattern implying etymology, insert "มาจาก"
        // Look for: Space + Thai Word + Space + ธาตุ OR Space + Word + Space + บทหน้า
        // Modified to handle "อุป + นิ บทหน้า" pattern correctly (multiple words before บทหน้า)
        clean = clean.replace(/(\s|^)((?:[ก-๙]+\s+\+\s+)*[ก-๙]+)(\s+(?:ธาตุ|บทหน้า|อาคม))/g, (match, prefix, roots, suffix, offset, string) => {
             // Check context to avoid false positives (e.g. "ลบ อา ที่ ญา ธาตุ")
             const preceding = string.substring(Math.max(0, offset - 10), offset).trim(); // Look back short distance
             
             // 1. If already handled
             if (string.substring(Math.max(0, offset - 50), offset).includes('มาจาก') || string.substring(Math.max(0, offset - 50), offset).includes('color:#7f8c8d')) {
                 return match;
             }

             // 2. If preceded by preposition (ที่, ซึ่ง, จาก, ของ, แห่ง, +) -> likely part of explanation, not start
             // Also check for "ลบ" (delete), "แปลง" (transform), "ลง" (suffix) which are common in formation steps
             const invalidPreceding = /(ที่|ซึ่ง|จาก|ของ|แห่ง|\+|ลบ|แปลง|ลง|เป็น)$/;
             if (invalidPreceding.test(preceding)) {
                 return match;
             }

             // Insert "มาจาก"
             return `<br><span style="color:#7f8c8d; font-weight:bold;">มาจาก</span> ${roots}${suffix}`;
        });

        // 3.0.7 Suffix Analysis (ลง ... ปัจจัย) -> New Line
        // Pattern: "ลง" + Thai chars + "ปัจจัย"
        clean = clean.replace(/(\s)(ลง\s+[ก-๙\.\+]+\s+ปัจจัย)/g, '<br>$2');

        // 3.0.6 Word Formation Result (ได้รูป เป็น... / สำเร็จรูปเป็น...) -> Bold
        clean = clean.replace(/((?:ได้รูป\s*เป็น|สำเร็จรูป\s*เป็น)\s*[ก-๙\.\u0E00-\u0E7F]+)/g, '<span style="color:#2c3e50; font-weight:bold;">$1</span>');

        // 3.1 Declension (แจกเหมือน)
        // Enhanced to include preceding gender and handle "น.," prefix
        clean = clean.replace(/(น\.,\s*|^|\s|>)((?:(?:ปุ\.|อิ\.|อิต\.|อิตฺ\.|นปุ\.)\s*)?แจกเหมือน)/g, (match, prefix, content) => {
            if (prefix && prefix.includes('น.,')) {
                return `${prefix}<span style="color:#16a085; font-weight:bold;">${content}</span>`;
            }
            return `<br><span style="color:#16a085; font-weight:bold;">${content}</span>`;
        });

        // 3.1.5 Gender Sections (Leftover genders not followed by แจกเหมือน)
        // Catch ปุ. อิ. อิต. อิตฺ. นปุ. that start a sentence or section
        // Exclude if followed by "แจกเหมือน" (handled by 3.1)
        // SPECIAL: If preceded by "น.," (Noun), do NOT add new line, just style it.
        clean = clean.replace(/(น\.,\s*|^|\s|>)((?:ปุ|อิ|อิต|อิตฺ|นปุ)\.)(?!\s*แจกเหมือน)/g, (match, prefix, gender) => {
            if (prefix && prefix.includes('น.,')) {
                return `${prefix}<span style="color:#16a085; font-weight:bold;">${gender}</span>`;
            }
            return `<br><span style="color:#16a085; font-weight:bold;">${gender}</span>`;
        });

        // 3.2 Conditionals and Grammar Descriptions (Combined)
        // Use alternation to prevent "เป็น..." from matching inside "ถ้าเป็น..."
        // Updated: If "ถ้าเป็น..." is immediately followed by "เป็น...", keep them on the same line.
        
        // Build regex pattern from GRAMMAR_TERMS
        const specificTerms = [
            ...this.GRAMMAR_TERMS.samasa, 
            ...this.GRAMMAR_TERMS.taddhita, 
            ...this.GRAMMAR_TERMS.kitaka,
            ...this.GRAMMAR_TERMS.vibhatti,
            ...this.GRAMMAR_TERMS.vacaka,
            ...this.GRAMMAR_TERMS.akhyataPaccaya,
            ...this.GRAMMAR_TERMS.akhyataVibhatti,
            ...this.GRAMMAR_TERMS.rupaSadhana,
            ...this.GRAMMAR_TERMS.namaKitakaPaccaya,
            ...this.GRAMMAR_TERMS.kiriyaKitakaPaccaya
        ].sort((a, b) => b.length - a.length).join('|').replace(/\./g, '\\.');

        // Generic fallback: Matches words ending in สมาส/ตัทธิต/กิตก์ (NO SPACES allowed to prevent greedy matching)
        const genericPattern = "[ก-๙\\.]+(?:สมาส|ตัทธิต|กิตก์)";
        
        // Construct the full regex
        // p1: ถ้าเป็น... (Condition)
        // p2: เป็น... (Definition following Condition)
        // p3: ถ้าเป็น... (Condition alone)
        // p4: เป็น... (Definition alone)
        const grammarRegex = new RegExp(
            `(ถ้า\\s*เป็น(?:สมาส|ตัทธิต|กิตก์))(?:\\s*<br\\s*\\/?>\\s*|\\s+)(เป็น(?:${specificTerms}|${genericPattern}))|(ถ้า\\s*เป็น(?:สมาส|ตัทธิต|กิตก์))|(เป็น(?:${specificTerms}|${genericPattern}))`, 
            'g'
        );

        clean = clean.replace(grammarRegex, (match, p1, p2, p3, p4) => {
            if (p1 && p2) {
                // Case 1: "ถ้าเป็น..." followed by "เป็น..." -> Same line (remove break between them)
                return `<br><span style="color:#2980b9; font-weight:bold;">${p1}</span> <span style="color:#8e44ad;">${p2}</span>`;
            } else if (p3) {
                // Case 2: "ถ้าเป็น..." alone -> New Line + Blue Bold
                return `<br><span style="color:#2980b9; font-weight:bold;">${p3}</span>`;
            } else if (p4) {
                // Case 3: "เป็น..." alone -> New Line + Purple
                return `<br><span style="color:#8e44ad;">${p4}</span>`;
            }
            return match;
        });

        // 3.3 Analysis Steps (Chain of abbreviations ending in วิ. or วิ.ว่า) -> New Line + Orange Bold
        // Captures "กฺวิ. กัต. กัต. วิ." or "วิ.ว่า" or "วิ."
        // We look for a sequence of Thai chars + dot + spaces, ending with วิ. or วิ.ว่า
        clean = clean.replace(/(^|\s|>)((?:[ก-๙]+\.\s*)+วิ\.(?:ว่า)?)/g, '<br><span style="color:#d35400; font-weight:bold;">$2</span>');
        
        // Fallback for isolated "วิ.ว่า" if not caught by above complex regex
        clean = clean.replace(/(?<!\.)\s(วิ\.ว่า)/g, '<br><span style="color:#d35400; font-weight:bold;">$1</span>');
        
        // 4. Cleanup excessive breaks (in case we added too many)
        clean = clean.replace(/(<br\s*\/?>\s*){2,}/gi, '<br>');
        
        return clean;
    }
};

// Export for module environments if needed (optional)
if (typeof module !== 'undefined' && module.exports) {
    module.exports = PaliFormatter;
}
