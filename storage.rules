rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {

    // 1) Public Assets - ไฟล์ที่ตั้งใจให้คนทั่วไปเห็นได้
    //    ต้องอัปโหลดไว้ใต้โฟลเดอร์ public/ เท่านั้น
    match /public/{allPaths=**} {
      // อ่านได้ทุกคน (รวมผู้ที่ไม่ได้ล็อกอิน)
      allow read: if true;

      // เขียน: จำกัดเฉพาะ admin (หรือ backend ผ่าน admin SDK ที่ bypass rules)
      allow write: if request.auth != null && request.auth.token.admin == true;
    }

    // 2) User Uploads - ไฟล์ส่วนตัวของผู้ใช้
    //    path: user_uploads/{uid}/{filename}
    match /user_uploads/{userId}/{fileName} {
      // อ่าน/เขียนเฉพาะเจ้าของไฟล์ หรือ admin
      allow read, write: if request.auth != null &&
        (request.auth.uid == userId || request.auth.token.admin == true);
    }

    // 3) Admin-only Area - สำหรับไฟล์สำรอง/รายงาน ฯลฯ
    //    path: admin/{anything}
    match /admin/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.token.admin == true;
    }

    // 4) Default Deny: path อื่นที่ไม่ได้ระบุ → ปิดทั้งหมด
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
