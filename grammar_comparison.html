<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เปรียบเทียบสูตรไวยากรณ์ ๔ คัมภีร์</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&family=Niramit:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f4f6f7;
            margin: 0;
            padding: 0;
            color: #2c3e50;
        }

        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .header-title h1 {
            margin: 0;
            font-size: 1.4rem;
            display: inline-block;
            margin-right: 10px;
        }

        .header-title span {
            color: #bdc3c7;
            font-size: 0.9rem;
        }

        .nav-bar {
            background-color: #34495e;
            padding: 10px 0;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .nav-btn {
            background: none;
            border: none;
            color: #bdc3c7;
            padding: 8px 15px;
            font-family: 'Sarabun', sans-serif;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 20px;
            margin: 0 5px;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            color: white;
            background-color: rgba(255,255,255,0.1);
        }

        .nav-btn.active {
            color: white;
            background-color: #16a085;
            font-weight: bold;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* Search Styles */
        .search-container {
            text-align: center;
            margin: 30px 0;
        }

        .search-input {
            width: 100%;
            max-width: 600px;
            padding: 15px 20px;
            font-size: 1.2rem;
            border: 2px solid #ddd;
            border-radius: 30px;
            font-family: 'Sarabun', sans-serif;
            outline: none;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .search-input:focus {
            border-color: #3498db;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2);
        }

        /* Results List */
        .result-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 5px solid #bdc3c7;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .result-card.kaccayana { border-left-color: #e74c3c; }
        .result-card.padarupasiddhi { border-left-color: #f39c12; }
        .result-card.moggallana { border-left-color: #27ae60; }
        .result-card.saddaniti { border-left-color: #8e44ad; }

        .result-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .result-source {
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .result-source.kaccayana { color: #c0392b; }
        .result-source.padarupasiddhi { color: #d35400; }
        .result-source.moggallana { color: #27ae60; }
        .result-source.saddaniti { color: #8e44ad; }

        .result-pali {
            font-family: 'Niramit', serif;
            font-size: 1.4rem;
            color: #2c3e50;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .result-thai {
            color: #16a085;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .result-topic {
            font-size: 0.85rem;
            color: #95a5a6;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #f1f1f1;
        }

        /* Scripture View */
        .scripture-view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .chapter-select {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #bdc3c7;
            font-family: 'Sarabun', sans-serif;
            font-size: 1rem;
            min-width: 250px;
        }

        .formula-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 700px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            animation: slideUp 0.3s ease-out;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 20px;
            background-color: #2c3e50;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
        }

        .modal-body {
            padding: 25px;
            overflow-y: auto;
        }

        .detail-pali {
            font-family: 'Niramit', serif;
            font-size: 1.8rem;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
            font-weight: 600;
        }

        .detail-label {
            font-weight: bold;
            color: #7f8c8d;
            font-size: 0.95rem;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .detail-thai {
            font-size: 1.2rem;
            color: #16a085;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .detail-desc {
            font-size: 1.1rem;
            color: #34495e;
            line-height: 1.8;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #bdc3c7;
        }

        .detail-ref {
            margin-top: 20px;
            text-align: right;
            font-style: italic;
            color: #95a5a6;
        }
        
        .detail-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.2s;
        }
        .detail-button:hover {
            background: #2980b9;
        }

        .back-btn {
            color: #ecf0f1;
            text-decoration: none;
            font-size: 0.9rem;
            border: 1px solid #ecf0f1;
            padding: 5px 10px;
            border-radius: 15px;
        }
        .back-btn:hover {
            background: white;
            color: #2c3e50;
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="header-title">
            <h1><i class="fa-solid fa-scale-balanced"></i> เปรียบเทียบสูตรไวยากรณ์</h1>
            <span>๔ คัมภีร์</span>
        </div>
        <a href="index.html" class="back-btn"><i class="fa-solid fa-arrow-left"></i> กลับหน้าหลัก</a>
    </div>

    <div class="nav-bar">
        <button class="nav-btn active" onclick="switchMode('search')" id="btn-search"><i class="fa-solid fa-magnifying-glass"></i> ค้นหา</button>
        <button class="nav-btn" onclick="switchMode('kaccayana')" id="btn-kaccayana">กัจจายนะ</button>
        <button class="nav-btn" onclick="switchMode('padarupasiddhi')" id="btn-padarupasiddhi">ปทรูปสิทธิ</button>
        <button class="nav-btn" onclick="switchMode('moggallana')" id="btn-moggallana">โมคคัลลานะ</button>
        <button class="nav-btn" onclick="switchMode('saddaniti')" id="btn-saddaniti">สัททนีติ</button>
    </div>

    <!-- Search View -->
    <div id="view-search" class="container">
        <div class="search-container">
            <input type="text" id="search-input" class="search-input" placeholder="พิมพ์คำค้นหา (บาลี, ไทย, หรือเลขสูตร เช่น ปท.๑๕)..." onkeyup="performSearch()">
            <p style="color:#7f8c8d; font-size: 0.9rem; margin-top: 10px;">ค้นหาได้ทั้งบาลี คำแปล หรือเลขข้อ จากทุกคัมภีร์พร้อมกัน</p>
        </div>
        <div id="search-results">
            <!-- Results will be injected here -->
            <div style="text-align: center; color: #95a5a6; margin-top: 50px;">
                <i class="fa-solid fa-book-open" style="font-size: 3rem; margin-bottom: 15px;"></i>
                <p>พิมพ์คำค้นหาเพื่อเริ่มค้นสูตรจากทั้ง ๔ คัมภีร์</p>
            </div>
        </div>
    </div>

    <!-- Scripture View -->
    <div id="view-scripture" class="container" style="display: none;">
        <div class="scripture-view-header">
            <h2 id="scripture-title" style="margin:0; border-bottom: 3px solid #34495e; padding-bottom: 5px;"></h2>
            <select id="chapter-select" class="chapter-select" onchange="renderScriptureContent()">
                <option value="all">แสดงทุกหมวด</option>
            </select>
        </div>
        <div id="scripture-content" class="formula-list">
            <!-- Content will be injected here -->
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detail-modal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content">
            <div class="modal-header" id="modal-header">
                <h2 class="modal-title" id="modal-scripture-name">ชื่อคัมภีร์</h2>
                <button class="modal-close" onclick="closeModal(event, true)">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-pali" id="modal-pali">...</div>
                
                <div class="detail-label">คำแปล:</div>
                <div class="detail-thai" id="modal-thai">...</div>
                
                <div class="detail-label">คำอธิบาย:</div>
                <div class="detail-desc" id="modal-desc">...</div>
                <div class="detail-ref" id="modal-ref">...</div>
                
                <div style="margin-top: 20px; text-align: right;">
                    <button id="modal-detail-btn" class="detail-button" onclick="goToDetail()">
                        ดูรายละเอียด (อุทาหรณ์)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="data/grammar_comparison_data.js"></script>
    <script>
        let currentMode = 'search';
        let allDataSections = [];
        let currentModalData = null;

        // Load and aggregate all data on startup
        window.onload = function() {
            aggregateData();
            // Check URL params for initial search or mode? (Optional)
        };

        function aggregateData() {
            // Collect all available data arrays
            const sources = [
                { data: typeof grammarComparisonData !== 'undefined' ? grammarComparisonData : [], name: 'main' },
                { data: typeof sandhiTable1Data !== 'undefined' ? sandhiTable1Data : [], name: 'sandhi1' },
                { data: typeof namaTable2Data !== 'undefined' ? namaTable2Data : [], name: 'nama2' },
                { data: typeof karakaTable3Data !== 'undefined' ? karakaTable3Data : [], name: 'karaka3' },
                { data: typeof samasaTable4Data !== 'undefined' ? samasaTable4Data : [], name: 'samasa4' },
                { data: typeof taddhitaTable5Data !== 'undefined' ? taddhitaTable5Data : [], name: 'taddhita5' },
                { data: typeof akhyataTable6Data !== 'undefined' ? akhyataTable6Data : [], name: 'akhyata6' },
                { data: typeof kittaTable7Data !== 'undefined' ? kittaTable7Data : [], name: 'kitta7' },
                { data: typeof unadiTable8Data !== 'undefined' ? unadiTable8Data : [], name: 'unadi8' }
            ];

            // Flatten into a list of sections (Topics)
            // We use a Map to dedup by Topic Name if necessary, but here we just list them all.
            // Actually, grammarComparisonData might overlap with others if not careful.
            // Based on previous code, grammarComparisonData contained Topic 1 & 2.
            // sandhiTable1Data contained Topic 2 (Sandhi).
            // We should be careful not to duplicate.
            
            // Let's trust the "Mode" logic from previous code:
            // The previous code had a mode select.
            // Here we want ALL data for search.
            // So we will add them all, but maybe filter out duplicates if topics are identical?
            
            // Let's just combine them. If there are duplicates, they will show up twice.
            // Better strategy: Use a list of unique topic objects.
            
            // Priority: main data first (rich descriptions), then specialized tables
            const orderedSources = [
                grammarComparisonData,
                sandhiTable1Data, namaTable2Data, karakaTable3Data, 
                samasaTable4Data, taddhitaTable5Data, akhyataTable6Data, 
                kittaTable7Data, unadiTable8Data
            ];

            const topicMap = new Map();

            orderedSources.forEach(source => {
                if (typeof source !== 'undefined' && Array.isArray(source)) {
                    source.forEach(section => {
                        if (!topicMap.has(section.topic)) {
                            // New topic: deep clone to avoid reference issues
                            const newSection = JSON.parse(JSON.stringify(section));
                            topicMap.set(section.topic, newSection);
                            allDataSections.push(newSection);
                        } else {
                            // Existing topic: Merge formulas
                            const existingSection = topicMap.get(section.topic);
                            
                            section.formulas.forEach(newFormula => {
                                // Try to find matching formula in existing section
                                // Match by Kaccayana Ref (e.g. "กัจ. ๑") or Pali text
                                let matchFound = false;
                                
                                // Helper to get ref string
                                const getRef = (f, type) => f[type] ? f[type].ref : '';
                                const getPali = (f, type) => f[type] ? f[type].pali : '';
                                
                                const newKaccRef = getRef(newFormula, 'kaccayana');
                                const newPali = getPali(newFormula, 'kaccayana') || getPali(newFormula, 'padarupasiddhi');

                                if (newKaccRef) {
                                    const existing = existingSection.formulas.find(f => getRef(f, 'kaccayana') === newKaccRef);
                                    if (existing) {
                                        // Merge data fields
                                        ['padarupasiddhi', 'moggallana', 'saddaniti', 'kaccayana'].forEach(scripture => {
                                            if (newFormula[scripture]) {
                                                if (!existing[scripture]) {
                                                    existing[scripture] = newFormula[scripture];
                                                } else {
                                                    // Merge fields if missing (prefer existing rich data)
                                                    Object.keys(newFormula[scripture]).forEach(key => {
                                                        if (!existing[scripture][key]) {
                                                            existing[scripture][key] = newFormula[scripture][key];
                                                        }
                                                    });
                                                }
                                            }
                                        });
                                        matchFound = true;
                                    }
                                }
                                
                                if (!matchFound) {
                                    // Add as new formula
                                    existingSection.formulas.push(JSON.parse(JSON.stringify(newFormula)));
                                }
                            });
                        }
                    });
                }
            });
        }

        function switchMode(mode) {
            currentMode = mode;
            
            // Update UI Buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + mode).classList.add('active');

            // Toggle Views
            if (mode === 'search') {
                document.getElementById('view-search').style.display = 'block';
                document.getElementById('view-scripture').style.display = 'none';
                document.getElementById('search-input').focus();
            } else {
                document.getElementById('view-search').style.display = 'none';
                document.getElementById('view-scripture').style.display = 'block';
                setupScriptureView(mode);
            }
        }

        function performSearch() {
            const query = document.getElementById('search-input').value.toLowerCase().trim();
            const resultsContainer = document.getElementById('search-results');
            
            if (!query) {
                resultsContainer.innerHTML = `
                    <div style="text-align: center; color: #95a5a6; margin-top: 50px;">
                        <i class="fa-solid fa-book-open" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <p>พิมพ์คำค้นหาเพื่อเริ่มค้นสูตรจากทั้ง ๔ คัมภีร์</p>
                    </div>`;
                return;
            }

            let html = '';
            let matchCount = 0;

            allDataSections.forEach((section, sectionIdx) => {
                section.formulas.forEach((row, formulaIdx) => {
                    // Check each scripture in the row
                    ['kaccayana', 'padarupasiddhi', 'moggallana', 'saddaniti'].forEach(scripture => {
                        const data = row[scripture];
                        if (data) {
                            const match = (data.pali && data.pali.toLowerCase().includes(query)) ||
                                          (data.thai && data.thai.toLowerCase().includes(query)) ||
                                          (data.ref && data.ref.toLowerCase().includes(query));
                            
                            if (match) {
                                matchCount++;
                                html += createResultCard(data, scripture, section.topic, sectionIdx, formulaIdx);
                            }
                        }
                    });
                });
            });

            if (matchCount === 0) {
                resultsContainer.innerHTML = '<div style="text-align:center; padding:40px; color:#7f8c8d;">ไม่พบข้อมูลที่ตรงกับคำค้นหา</div>';
            } else {
                resultsContainer.innerHTML = `<p style="text-align:right; color:#7f8c8d; margin-bottom:10px;">พบ ${matchCount} รายการ</p>` + html;
            }
        }

        function createResultCard(data, scripture, topic, sectionIdx, formulaIdx) {
            const scriptureNames = {
                'kaccayana': 'กัจจายนะ',
                'padarupasiddhi': 'ปทรูปสิทธิ',
                'moggallana': 'โมคคัลลานะ',
                'saddaniti': 'สัททนีติ'
            };
            
            // Safe encode for data attribute
            const safeData = JSON.stringify(data).replace(/"/g, '&quot;');

            return `
                <div class="result-card ${scripture}" onclick="openModal('${scripture}', this)" 
                     data-content="${safeData}" 
                     data-topic-idx="${sectionIdx}" 
                     data-formula-idx="${formulaIdx}">
                    <div class="result-header">
                        <span class="result-source ${scripture}">${scriptureNames[scripture]}</span>
                        <span>${data.ref || ''}</span>
                    </div>
                    <div class="result-pali">${data.pali || '-'}</div>
                    <div class="result-thai">${data.thai || ''}</div>
                    <div class="result-topic">${topic}</div>
                </div>
            `;
        }

        // --- Scripture View Logic ---

        function setupScriptureView(scripture) {
            const names = {
                'kaccayana': 'คัมภีร์กัจจายนะ',
                'padarupasiddhi': 'คัมภีร์ปทรูปสิทธิ',
                'moggallana': 'คัมภีร์โมคคัลลานะ',
                'saddaniti': 'คัมภีร์สัททนีติ'
            };
            document.getElementById('scripture-title').innerText = names[scripture];
            
            // Populate Chapter Select
            const chapterSelect = document.getElementById('chapter-select');
            chapterSelect.innerHTML = '<option value="all">แสดงทุกหมวด</option>';
            
            // Find topics that actually contain this scripture
            allDataSections.forEach((section, idx) => {
                const hasScripture = section.formulas.some(row => row[scripture]);
                if (hasScripture) {
                    const option = document.createElement('option');
                    option.value = idx;
                    option.text = section.topic;
                    chapterSelect.appendChild(option);
                }
            });

            renderScriptureContent();
        }

        function renderScriptureContent() {
            const scripture = currentMode;
            const selectedChapter = document.getElementById('chapter-select').value;
            const container = document.getElementById('scripture-content');
            
            let allItems = [];
            
            // 1. Collect all items
            allDataSections.forEach((section, sectionIdx) => {
                if (selectedChapter !== 'all' && String(sectionIdx) !== selectedChapter) return;

                section.formulas.forEach((row, formulaIdx) => {
                    if (row[scripture]) {
                        allItems.push({
                            data: row[scripture],
                            topic: section.topic,
                            sectionIdx: sectionIdx,
                            formulaIdx: formulaIdx
                        });
                    }
                });
            });

            // 2. Sort items by Reference Number
            allItems.sort((a, b) => {
                const getRefNums = (str) => {
                    if (!str) return [999999]; // No ref goes to end
                    // Extract Thai digits
                    const matches = str.match(/[๐-๙]+/g);
                    if (!matches) return [999999];
                    return matches.map(s => {
                        // Convert Thai to Arabic
                        return parseInt(s.replace(/[๐-๙]/g, c => "๐๑๒๓๔๕๖๗๘๙".indexOf(c)));
                    });
                };

                const numsA = getRefNums(a.data.ref);
                const numsB = getRefNums(b.data.ref);

                // Compare first number
                if (numsA[0] !== numsB[0]) return numsA[0] - numsB[0];
                // Compare second number (if exists, e.g. Moggallana 1/1 vs 1/2)
                if (numsA.length > 1 && numsB.length > 1) {
                    return numsA[1] - numsB[1];
                }
                return 0;
            });

            // 3. Render
            if (allItems.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:40px;">ไม่พบข้อมูลในหมวดนี้</div>';
                return;
            }

            let html = '';
            // If "All", we might want to show headers? 
            // But if sorted by Formula, headers (Topics) might be interleaved.
            // User requested "ordered by formula", so a flat list is best.
            // We show the topic in the card anyway.

            allItems.forEach(item => {
                html += createResultCard(item.data, scripture, item.topic, item.sectionIdx, item.formulaIdx);
            });
            
            container.innerHTML = html;
        }

        // --- Modal Logic ---

        function openModal(type, element) {
            const content = element.getAttribute('data-content');
            const data = JSON.parse(content);
            
            // Store for "View Details" navigation
            currentModalData = {
                mode: type, // This is roughly correct, though 'mode' in formula_detail.html expects 'sandhi1' etc. 
                            // We need to pass the TABLE mode (e.g. sandhi1) to formula_detail.
                            // But here we have sectionIdx. We can map sectionIdx back to table mode if needed, 
                            // OR update formula_detail to handle sectionIdx.
                topicIdx: element.getAttribute('data-topic-idx'),
                formulaIdx: element.getAttribute('data-formula-idx'),
                type: type
            };

            const names = {
                'kaccayana': 'กัจจายนะ',
                'padarupasiddhi': 'ปทรูปสิทธิ',
                'moggallana': 'โมคคัลลานะ',
                'saddaniti': 'สัททนีติ'
            };
            const colors = {
                'kaccayana': '#e74c3c',
                'padarupasiddhi': '#f39c12',
                'moggallana': '#27ae60',
                'saddaniti': '#8e44ad'
            };

            document.getElementById('modal-header').style.backgroundColor = colors[type] || '#2c3e50';
            document.getElementById('modal-scripture-name').innerText = names[type] || type;
            document.getElementById('modal-pali').innerText = data.pali || '-';
            document.getElementById('modal-thai').innerText = data.thai || '-';
            document.getElementById('modal-desc').innerText = data.desc || 'ไม่มีคำอธิบายเพิ่มเติม';
            document.getElementById('modal-ref').innerText = data.ref || '';
            
            const modal = document.getElementById('detail-modal');
            modal.style.display = 'flex';
        }

        function closeModal(event, force) {
            if (force || event.target.classList.contains('modal-overlay')) {
                document.getElementById('detail-modal').style.display = 'none';
            }
        }

        function goToDetail() {
            if (!currentModalData) return;
            // Note: formula_detail.html expects params: mode, topicIndex, formulaIndex, type
            // Our 'mode' param (e.g. 'sandhi1') determines which variable to load in formula_detail.html
            // We need to reverse-engineer which "variable" the sectionIdx belongs to.
            // This is tricky because we flattened the data.
            
            // Quick Fix: Pass the 'all' mode or handle it in formula_detail.
            // But formula_detail uses: window.grammarComparisonData[topicIndex] if mode is missing?
            
            // Let's pass the raw indices. In formula_detail, we might need to load ALL data like we did here.
            // For now, let's just pass what we have and see if we need to update formula_detail.html.
            // Since we use `allDataSections` here which is aggregated, index 0 might be Sandhi Table 1 (if priority sorted) or GrammarComparisonData.
            
            // To make it robust: We should ideally update formula_detail.html to also use the aggregated data approach.
            // For this step, I will just construct the URL.
            
            window.location.href = `formula_detail.html?topicIndex=${currentModalData.topicIdx}&formulaIndex=${currentModalData.formulaIdx}&type=${currentModalData.type}&useGlobal=true`;
        }
    </script>
</body>
</html>
