<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏ö‡∏≤‡∏•‡∏µ (Interactive Board)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Niramit:wght@400;500;600&family=Sarabun:wght@300;400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- CSS ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (Full Screen Theme) --- */
        body {
            margin: 0;
            padding: 0;
            background-color: #37474f;
            font-family: 'Sarabun', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #37474f;
            overflow: hidden;
        }

        /* --- ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ & ‡πÅ‡∏Å‡πâ Layout ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏á‡∏õ‡∏∏‡πà‡∏°) --- */
        .card {
            width: 98%;
            max-width: none;
            height: 92vh;
            /* ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏° Nav */
            max-height: none;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            margin-bottom: 50px;
            /* ‡∏î‡∏±‡∏ô‡∏õ‡∏∏‡πà‡∏° Nav ‡∏•‡∏á‡πÑ‡∏õ */
        }

        .header-bar {
            height: 6px;
            background: linear-gradient(90deg, #263238, #546e7a, #78909c);
            width: 100%;
            flex-shrink: 0;
        }

        /* --- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏ö‡∏ö Split View --- */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding: 0;
            background-color: #f5f5f5;
        }

        .split-pane {
            flex: 1;
            overflow-y: auto;
            padding: 25px 60px;
            background-color: #fff;
            position: relative;
            border-bottom: 4px solid #eceff1;
        }

        .split-pane:last-child {
            border-bottom: none;
        }

        .split-pane::-webkit-scrollbar {
            width: 10px;
        }

        .split-pane::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .split-pane::-webkit-scrollbar-thumb {
            background: #b0bec5;
            border-radius: 5px;
        }

        /* ‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á */
        .pane-label {
            position: sticky;
            top: 0;
            left: 0;
            display: inline-block;
            background: #eceff1;
            color: #78909c;
            padding: 2px 10px;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 10px;
            z-index: 5;
            opacity: 0.9;
        }

        /* --- CSS ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô) --- */
        .pali-text {
            font-family: 'Niramit', serif;
            font-size: 1.8rem;
            color: #263238;
            font-weight: 600;
            line-height: 2;
            margin-bottom: 0;
            text-align: left;
            text-indent: 50px;
            word-spacing: 0;
            letter-spacing: 0;
            word-break: normal;
            overflow-wrap: break-word;
            transition: all 0.3s ease;
        }

        .thai-text {
            font-family: 'Sarabun', sans-serif;
            font-size: 1.4rem;
            color: #546e7a;
            font-weight: 300;
            line-height: 2;
            text-align: left;
            text-indent: 50px;
            word-break: normal;
            overflow-wrap: break-word;
            transition: opacity 0.3s ease, font-size 0.3s ease, text-align 0.3s ease;
            opacity: 1;
        }

        .thai-text.hidden {
            opacity: 0;
            user-select: none;
            pointer-events: none;
        }

        /* --- CSS ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå --- */
        .word-span {
            cursor: pointer;
            display: inline;
            padding: 0;
            margin: 0;
            border-bottom: 2px solid transparent;
            transition: color 0.2s, border-color 0.2s;
        }

        .word-span:hover {
            color: #1565C0;
        }

        .word-span.translated {
            color: #1565C0;
            border-bottom-color: #1565C0;
        }

        .word-span.has-info {
            border-bottom: 2px dotted #aaa;
        }

        .word-span.has-info.translated {
            border-bottom: 2px dotted #1565C0;
        }

        /* --- CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Canvas ‡∏ß‡∏≤‡∏î‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô (Whiteboard) --- */
        #drawing-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 50;
            /* ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (text) ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ï‡πâ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ */
            pointer-events: none;
            /* ‡∏õ‡∏Å‡∏ï‡∏¥‡πÉ‡∏´‡πâ‡∏ó‡∏∞‡∏•‡∏∏‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÑ‡∏î‡πâ */
            touch-action: none;
            /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏à‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏ô iPad */
        }

        /* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏≤‡∏î‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô */
        .card.drawing-mode #drawing-canvas {
            pointer-events: auto;
            /* ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏µ‡∏î‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô */
            cursor: crosshair;
        }

        /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏≤‡∏î */
        .tool-btn.active-pen {
            background-color: #3498db !important;
            color: white !important;
        }

        /* --- Footer (4 ‡∏ä‡πà‡∏≠‡∏á) --- */
        .footer-box {
            background-color: #f7f9f9;
            border-top: 1px solid #eceff1;
            height: 160px;
            display: flex;
            padding: 0;
            flex-shrink: 0;
        }

        .footer-section {
            flex: 1;
            padding: 15px 25px;
            border-right: 1px solid #eceff1;
            display: flex;
            flex-direction: column;
            text-align: left;
            overflow-y: auto;
        }

        .footer-section:last-child {
            border-right: none;
        }

        .sec-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: #90a4ae;
            text-transform: uppercase;
            margin-bottom: 8px;
            border-bottom: 1px solid #cfd8dc;
            padding-bottom: 3px;
        }

        .sec-content {
            font-size: 1.1rem;
            color: #37474f;
            line-height: 1.6;
        }

        .pali-word {
            font-family: 'Niramit', serif;
            color: #0277bd;
            font-weight: 600;
        }

        .clickable-analysis {
            color: #1976D2;
            cursor: pointer;
            text-decoration: underline;
            text-decoration-style: dotted;
            text-underline-offset: 3px;
            transition: all 0.2s;
        }

        .clickable-analysis:hover {
            color: #0D47A1;
            background-color: #e3f2fd;
            border-radius: 4px;
        }

        /* --- Controls & UI --- */
        .page-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(236, 239, 241, 0.9);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 1rem;
            color: #78909c;
            font-weight: bold;
            z-index: 100;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            display: flex;
            gap: 20px;
            z-index: 200;
        }

        button.nav-btn {
            padding: 12px 30px;
            background-color: #455a64;
            border: none;
            border-radius: 50px;
            font-family: 'Sarabun', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: #ffffff;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        button.nav-btn:hover {
            background-color: #607d8b;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
        }

        /* Tools Sidebar */
        .tools-sidebar {
            position: absolute;
            top: 70px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        .tool-btn {
            position: relative;
            padding: 8px 12px;
            border-radius: 8px;
            background-color: #eceff1;
            color: #546e7a;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
        }

        .tool-btn:hover {
            background-color: #cfd8dc;
            transform: translateX(-2px);
        }

        /* Settings Panel */
        .settings-panel {
            position: absolute;
            top: 70px;
            right: 70px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 50;
            display: none;
            flex-direction: column;
            gap: 10px;
            width: 180px;
            border: 1px solid #eceff1;
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-label {
            font-size: 0.9rem;
            font-weight: bold;
            color: #546e7a;
        }

        .settings-btn-group {
            display: flex;
            gap: 5px;
        }

        .set-btn {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.9rem;
            color: #333;
        }

        .set-btn:hover {
            background: #e0e0e0;
        }

        .set-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        /* Tooltip & Sticky Note & Modal CSS */
        #sandhi-tooltip {
            position: fixed;
            display: none;
            background-color: #37474f;
            color: #fff;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 1.2rem;
            font-family: 'Sarabun', sans-serif;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            z-index: 2000;
            pointer-events: none;
            white-space: nowrap;
            border: 1px solid #546e7a;
        }

        #sandhi-tooltip span.split {
            color: #ffca28;
            font-weight: bold;
        }

        #sandhi-tooltip span.origin {
            color: #b0bec5;
            font-size: 0.9em;
            margin-left: 5px;
        }

        .sticky-note {
            position: absolute;
            background: #fff9c4;
            border: 1px solid #fbc02d;
            padding: 15px;
            min-width: 200px;
            max-width: 300px;
            border-radius: 5px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 500;
            font-size: 1.1rem;
            color: #333;
            cursor: move;
            font-family: 'Sarabun', sans-serif;
        }

        .sticky-note:focus {
            outline: 2px solid #2980b9;
        }

        .close-note {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            text-align: center;
            line-height: 24px;
            font-size: 14px;
            cursor: pointer;
            display: none;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .sticky-note:hover .close-note {
            display: block;
        }

        .analysis-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            backdrop-filter: blur(3px);
        }

        .analysis-card {
            background: white;
            width: 90%;
            max-width: 600px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .analysis-header {
            background: #2c3e50;
            color: white;
            padding: 25px;
            position: relative;
        }

        .analysis-word {
            font-family: 'Niramit', serif;
            font-size: 2.2rem;
            margin: 0;
            font-weight: 500;
        }

        .analysis-close {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 2rem;
            cursor: pointer;
            color: #ccc;
        }

        .analysis-close:hover {
            color: white;
        }

        .analysis-body {
            padding: 30px;
        }

        .analysis-split {
            font-size: 1.6rem;
            color: #d35400;
            font-weight: bold;
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .analysis-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .analysis-list li {
            font-size: 1.2rem;
            margin-bottom: 18px;
            line-height: 1.8;
            display: flex;
            align-items: flex-start;
            color: #2c3e50;
            text-align: left;
        }

        .analysis-list li::before {
            content: "‚Ä¢";
            color: #3498db;
            font-weight: bold;
            font-size: 1.5rem;
            line-height: 1;
            margin-right: 10px;
        }

        @media screen and (max-width: 768px) {
            .card {
                height: 90vh;
                margin-top: -40px;
                width: 95%;
                margin-bottom: 60px;
            }

            .split-pane {
                padding: 20px;
            }

            .pali-text {
                font-size: 1.4rem;
            }

            .thai-text {
                font-size: 1.2rem;
            }

            .footer-box {
                height: auto;
                flex-direction: column;
                overflow-y: auto;
                min-height: 120px;
                max-height: 30%;
            }

            .footer-section {
                border-right: none;
                border-bottom: 1px solid #eceff1;
                padding: 10px 20px;
            }

            .controls {
                bottom: 10px;
                gap: 10px;
            }

            button.nav-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .page-badge {
                right: 15px;
                top: 15px;
            }

            .tools-sidebar {
                top: 60px;
                right: 15px;
            }
        }
    </style>
</head>

<body>

    <div class="card" id="cardContainer">
        <div class="header-bar"></div>
        <div class="page-badge" id="pageNumber">1</div>

        <div class="tools-sidebar">
            <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ -->
            <button class="tool-btn" id="btn-settings" title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•" onclick="toggleSettings()">
                <i class="fa-solid fa-gear"></i>
            </button>

            <!-- ‡πÅ‡∏ú‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà) -->
            <div id="settings-panel" class="settings-panel">
                <div class="settings-row">
                    <span class="settings-label">‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</span>
                    <div class="settings-btn-group">
                        <button class="set-btn" onclick="changeFontSize(-1)"><i class="fa-solid fa-minus"></i></button>
                        <button class="set-btn" onclick="changeFontSize(1)"><i class="fa-solid fa-plus"></i></button>
                    </div>
                </div>
                <div class="settings-row" style="margin-top:10px; display:block;">
                    <span class="settings-label" style="display:block; margin-bottom:5px;">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ß‡∏≤‡∏á</span>
                    <div class="settings-btn-group" style="justify-content: space-between;">
                        <button class="set-btn" onclick="setTextAlign('left')" title="‡∏ä‡∏¥‡∏î‡∏ã‡πâ‡∏≤‡∏¢"><i
                                class="fa-solid fa-align-left"></i></button>
                        <button class="set-btn" onclick="setTextAlign('center')" title="‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á"><i
                                class="fa-solid fa-align-center"></i></button>
                        <button class="set-btn active" onclick="setTextAlign('justify')" title="‡πÄ‡∏™‡∏°‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏á"><i
                                class="fa-solid fa-align-justify"></i></button>
                    </div>
                </div>
            </div>

            <button class="tool-btn" id="btn-toggle-thai" title="‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á ‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•" onclick="toggleThai()">
                <i class="fa-solid fa-eye"></i>
            </button>

            <!-- ********** 1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤ ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö ********** -->
            <button class="tool-btn" id="btn-pen" title="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (Whiteboard)" onclick="toggleDrawingMode()">
                <i class="fa-solid fa-pen"></i>
            </button>
            <button class="tool-btn" id="btn-clear-ink" title="‡∏•‡∏ö‡∏´‡∏°‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" onclick="clearCanvas()"
                style="display:none; color: #e74c3c;">
                <i class="fa-solid fa-trash-can"></i>
            </button>

            <button class="tool-btn" id="btn-add-note" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (Note)" onclick="addNote()">
                <i class="fa-solid fa-note-sticky"></i>
            </button>
        </div>

        <canvas id="drawing-canvas"></canvas>

        <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏ö‡∏ö Split View -->
        <div class="content-area">
            <div class="split-pane" style="flex: 1; border-bottom: 4px solid #eceff1;">
                <span class="pane-label">‡∏ö‡∏≤‡∏•‡∏µ</span>
                <div class="pali-text" id="paliContent">...</div>
            </div>
            <div class="split-pane" style="flex: 1;">
                <span class="pane-label">‡πÑ‡∏ó‡∏¢</span>
                <div class="thai-text" id="thaiContent">...</div>
            </div>
        </div>

        <div class="footer-box">
            <!-- 1. ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó -->
            <div class="footer-section" style="flex: 1;">
                <div class="sec-title">üìù ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó / ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</div>
                <div class="sec-content" id="contextContent">...</div>
            </div>

            <!-- 2. ‡∏≠‡∏≤‡∏Ç‡∏¢‡∏≤‡∏ï -->
            <div class="footer-section" style="flex: 0.8;">
                <div class="sec-title">üîπ ‡∏≠‡∏≤‡∏Ç‡∏¢‡∏≤‡∏ï (‡∏Ñ‡∏∏‡∏°‡∏û‡∏≤‡∏Å‡∏¢‡πå)</div>
                <div class="sec-content pali-word" id="akhyataContent">...</div>
            </div>

            <!-- 3. ‡∏Å‡∏¥‡∏ï‡∏Å‡πå -->
            <div class="footer-section" style="flex: 0.8;">
                <div class="sec-title">üî∏ ‡∏Å‡∏¥‡∏£‡∏¥‡∏¢‡∏≤‡∏Å‡∏¥‡∏ï‡∏Å‡πå</div>
                <div class="sec-content pali-word" id="kitakaContent">...</div>
            </div>

            <!-- 4. ‡∏®‡∏±‡∏û‡∏ó‡πå/‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå -->
            <div class="footer-section" style="flex: 1.2;">
                <div class="sec-title">üìö ‡∏®‡∏±‡∏û‡∏ó‡πå / ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡∏™‡∏°‡∏≤‡∏™/‡∏ï‡∏±‡∏ó‡∏ò‡∏¥‡∏ï)</div>
                <div class="sec-content pali-word" id="vocabContent">...</div>
            </div>
        </div>
    </div>

    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏≥‡∏ó‡∏≤‡∏á (‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á) -->
    <div class="controls">
        <button class="nav-btn" onclick="prevSlide()">‚ùÆ ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="nav-btn" onclick="resetHighlights()" style="background-color: #e57373;">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
        <button class="nav-btn" onclick="nextSlide()">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ùØ</button>
    </div>

    <div id="sandhi-tooltip"></div>

    <div id="analysis-modal" class="analysis-modal-overlay" onclick="closeAnalysisModal(event)">
        <div class="analysis-card">
            <div class="analysis-header">
                <h2 id="ana-word" class="analysis-word">...</h2>
                <span class="analysis-close" onclick="closeAnalysisModal(event, true)">&times;</span>
            </div>
            <div class="analysis-body">
                <div id="ana-split" class="analysis-split">...</div>
                <ul id="ana-details" class="analysis-list"></ul>
            </div>
        </div>
    </div>

    <!-- Load Scripts -->
    <script src="vocab-akhyata.js"></script>
    <script src="vocab-kitaka.js"></script>
    <script src="vocab-samasa.js"></script>
    <script src="vocab-taddhita.js"></script>
    <script src="vocab-general.js"></script>

    <script src="slides-part1.js"></script>
    <script src="slides-part2.js"></script>
    <script src="slides-part3.js"></script>
    <script src="slides-part4.js"></script>
    <script src="slides-part5.js"></script>
    <script src="slides-part6.js"></script>
    <script src="slides-part7.js"></script>
    <script src="slides-part8.js"></script>

    <script>
        const commonAnalysis = Object.assign({},
            (typeof vocabGeneral !== 'undefined' ? vocabGeneral : {}),
            (typeof vocabAkhyata !== 'undefined' ? vocabAkhyata : {}),
            (typeof vocabKitaka !== 'undefined' ? vocabKitaka : {}),
            (typeof vocabSamasa !== 'undefined' ? vocabSamasa : {}),
            (typeof vocabTaddhita !== 'undefined' ? vocabTaddhita : {})
        );

        const slidesDatabase = Object.assign({},
            (typeof slidesPart1 !== 'undefined' ? slidesPart1 : {}),
            (typeof slidesPart2 !== 'undefined' ? slidesPart2 : {}),
            (typeof slidesPart3 !== 'undefined' ? slidesPart3 : {}),
            (typeof slidesPart4 !== 'undefined' ? slidesPart4 : {}),
            (typeof slidesPart5 !== 'undefined' ? slidesPart5 : {}),
            (typeof slidesPart6 !== 'undefined' ? slidesPart6 : {}),
            (typeof slidesPart7 !== 'undefined' ? slidesPart7 : {}),
            (typeof slidesPart8 !== 'undefined' ? slidesPart8 : {})
        );

        const params = new URLSearchParams(window.location.search);
        const slideId = params.get('id');

        let slides = [];
        if (slideId && slidesDatabase[slideId]) {
            slides = slidesDatabase[slideId];
        } else {
            slides = [{ pali: "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô", thai: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™ (ID) ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", context: "-", akhyata: "-", kitaka: "-" }];
        }

        let currentIndex = 0;

        // --- Settings Logic ---
        let currentFontSizePali = 1.8;
        let currentFontSizeThai = 1.8;

        function toggleSettings() {
            const panel = document.getElementById('settings-panel');
            panel.style.display = (panel.style.display === 'flex') ? 'none' : 'flex';
        }

        function changeFontSize(change) {
            currentFontSizePali += (change * 0.2);
            currentFontSizeThai += (change * 0.2);
            if (currentFontSizePali < 1.0) currentFontSizePali = 1.0;
            if (currentFontSizeThai < 1.0) currentFontSizeThai = 1.0;

            document.querySelector('.pali-text').style.fontSize = `${currentFontSizePali}rem`;
            document.querySelector('.thai-text').style.fontSize = `${currentFontSizeThai}rem`;
        }

        function setTextAlign(align) {
            document.querySelector('.pali-text').style.textAlign = align;
            document.querySelector('.thai-text').style.textAlign = align;
            if (align !== 'justify') {
                document.querySelector('.pali-text').style.textIndent = '0';
                document.querySelector('.thai-text').style.textIndent = '0';
            } else {
                document.querySelector('.pali-text').style.textIndent = '50px';
                document.querySelector('.thai-text').style.textIndent = '50px';
            }
            document.querySelectorAll('.set-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('button').classList.add('active');
        }

        function wrapWords(text, vocabData) {
            if (!text) return "";
            return text.split(' ').map(word => {
                if (word.trim() === "") return "";
                const parts = word.match(/^([‚Äú"'(‚Äò]*)(.+?)([)‚Äù"'.‡∏Ø,;:?‚Äô]+)?$/);
                let prefix = "", cleanWord = word, suffix = "";
                if (parts) { prefix = parts[1] || ""; cleanWord = parts[2]; suffix = parts[3] || ""; }
                let displayText = cleanWord.replace(/_/g, ' ');
                let searchKey = displayText;

                const data = getAnalysisData(searchKey, vocabData);
                let vocabInfo = ""; let hasInfoClass = "";

                if (data) {
                    if (data.type === 'sandhi' || !data.type) {
                        vocabInfo = `data-word="${searchKey}"`;
                        hasInfoClass = "has-info";
                    }
                }
                return `${prefix}<span class="word-span ${hasInfoClass}" 
                              ${vocabInfo}
                              onmouseenter="showTooltip(this)" 
                              onmouseleave="hideTooltip()"
                              onclick="toggleHighlight(this)">${displayText}</span>${suffix}`;
            }).join(' ');
        }

        function getAnalysisData(word, slide) {
            if (slide) {
                if (slide.analysis && slide.analysis[word]) return slide.analysis[word];
                if (slide.sandhi && slide.sandhi[word]) return { type: "sandhi", split: slide.sandhi[word] };
                if (slide.vocab && slide.vocab[word]) return { type: "sandhi", split: slide.vocab[word] };
            }
            if (typeof commonAnalysis !== 'undefined' && commonAnalysis[word]) {
                return commonAnalysis[word];
            }
            return null;
        }

        // ==========================================
        // ==      ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏î‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô (Whiteboard)       ==
        // ==========================================
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        const card = document.getElementById('cardContainer');
        let isDrawing = false;
        let isPenMode = false;

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î Canvas ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏à‡∏≠ (‡πÅ‡∏Å‡πâ‡∏†‡∏≤‡∏û‡πÄ‡∏ö‡∏•‡∏≠/‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏¢‡∏∑‡πâ‡∏≠‡∏á)
        function resizeCanvas() {
            const rect = card.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;

            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ñ‡πà‡∏≤‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î)
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#e74c3c'; // ‡∏™‡∏µ‡πÅ‡∏î‡∏á
        }

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢‡∏à‡∏≠
        window.addEventListener('resize', resizeCanvas);
        setTimeout(resizeCanvas, 500); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ã‡πâ‡∏≥‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô

        // --- ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤ ---
        function toggleDrawingMode() {
            isPenMode = !isPenMode;
            const btnPen = document.getElementById('btn-pen');
            const btnClear = document.getElementById('btn-clear-ink');

            if (isPenMode) {
                card.classList.add('drawing-mode');
                btnPen.classList.add('active-pen');
                btnClear.style.display = 'block'; // ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞
                resizeCanvas(); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏ß‡∏£‡πå
            } else {
                card.classList.remove('drawing-mode');
                btnPen.classList.remove('active-pen');
                btnClear.style.display = 'none';
            }
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // --- ‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏û‡∏¥‡∏Å‡∏±‡∏î (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å: ‡πÅ‡∏Å‡πâ‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏¢‡∏∑‡πâ‡∏≠‡∏á) ---
        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        // --- Event Listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏î ---
        function startDraw(e) {
            if (!isPenMode) return;
            if (e.type === 'touchstart') e.preventDefault();
            isDrawing = true;
            const pos = getPos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        function draw(e) {
            if (!isDrawing || !isPenMode) return;
            if (e.type === 'touchmove') e.preventDefault();
            const pos = getPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
        }

        function stopDraw() {
            isDrawing = false;
        }

        // Mouse Events (‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå)
        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDraw);
        canvas.addEventListener('mouseout', stopDraw);

        // Touch Events (iPad/‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)
        canvas.addEventListener('touchstart', startDraw, { passive: false });
        canvas.addEventListener('touchmove', draw, { passive: false });
        canvas.addEventListener('touchend', stopDraw);

        function updateSlide() {
            clearCanvas();
            if (typeof removeAllNotes === 'function') removeAllNotes();

            const paliBox = document.getElementById('paliContent');
            const thaiBox = document.getElementById('thaiContent');
            const s = slides[currentIndex];

            paliBox.innerHTML = wrapWords(s.pali, s);
            thaiBox.innerHTML = wrapWords(s.thai, null);

            paliBox.parentElement.scrollTop = 0;
            thaiBox.parentElement.scrollTop = 0;

            document.getElementById('akhyataContent').innerHTML = processFooterAnalysis(s.akhyata, s);
            document.getElementById('kitakaContent').innerHTML = processFooterAnalysis(s.kitaka, s);
            if (document.getElementById('vocabContent')) {
                document.getElementById('vocabContent').innerHTML = processFooterAnalysis(s.vocab_list || "-", s);
            }

            document.getElementById('contextContent').innerText = s.context;
            document.getElementById('pageNumber').innerText = `${currentIndex + 1} / ${slides.length}`;
            applyThaiState();
        }

        function getAllAnalysisKeys(localAnalysis) {
            let keys = [];
            if (localAnalysis && localAnalysis.analysis) keys = keys.concat(Object.keys(localAnalysis.analysis));
            if (localAnalysis && localAnalysis.sandhi) keys = keys.concat(Object.keys(localAnalysis.sandhi));
            if (localAnalysis && localAnalysis.vocab) keys = keys.concat(Object.keys(localAnalysis.vocab));
            if (typeof commonAnalysis !== 'undefined') keys = keys.concat(Object.keys(commonAnalysis));
            return [...new Set(keys)];
        }
        function processFooterAnalysis(text, slide) {
            if (!text) return "";
            let processedText = text;
            let allKeys = getAllAnalysisKeys(slide);
            allKeys.sort((a, b) => b.length - a.length);
            let replacements = [];
            let index = 0;
            allKeys.forEach(key => {
                const data = getAnalysisData(key, slide);
                if (data && processedText.includes(key)) {
                    const token = `##TOKEN_${index}##`;
                    const displayWord = key.split('#')[0];
                    replacements.push({
                        token: token,
                        html: `<span class="clickable-analysis" onclick="showAnalysis('${key}')">${displayWord}</span>`
                    });
                    processedText = processedText.split(key).join(token);
                    index++;
                }
            });
            replacements.forEach(item => { processedText = processedText.split(item.token).join(item.html); });
            return processedText;
        }

        function showAnalysis(word) {
            const s = slides[currentIndex];
            const data = getAnalysisData(word, s);
            if (!data) return;
            const displayTitle = word.split('#')[0];
            document.getElementById('ana-word').innerText = displayTitle;
            document.getElementById('ana-split').innerText = data.split || "";
            const list = document.getElementById('ana-details');
            list.innerHTML = '';
            if (data.details) {
                data.details.forEach(detail => {
                    const li = document.createElement('li');
                    li.innerText = detail;
                    list.appendChild(li);
                });
            }
            document.getElementById('analysis-modal').style.display = 'flex';
        }

        function closeAnalysisModal(event, force = false) {
            if (force || event.target.id === 'analysis-modal') {
                document.getElementById('analysis-modal').style.display = 'none';
            }
        }

        const tooltip = document.getElementById('sandhi-tooltip');
        function showTooltip(element) {
            const key = element.getAttribute('data-word');
            if (!key) return;
            const s = slides[currentIndex];
            const data = getAnalysisData(key, s);
            if (!data) return;
            const info = data.split || key;
            let formattedInfo = info;
            if (info.includes('(')) {
                const parts = info.split('(');
                formattedInfo = `<span class="split">${parts[0]}</span> <span class="origin">(${parts[1]}</span>`;
            } else {
                formattedInfo = `<span class="split">${info}</span>`;
            }
            tooltip.innerHTML = formattedInfo;
            tooltip.style.display = 'block';
            const rect = element.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();
            let top = rect.top - tooltipRect.height - 10;
            let left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
            if (top < 0) top = rect.bottom + 10;
            if (left < 10) left = 10;
            if (left + tooltipRect.width > window.innerWidth) left = window.innerWidth - tooltipRect.width - 10;
            tooltip.style.top = `${top}px`;
            tooltip.style.left = `${left}px`;
        }
        function hideTooltip() { tooltip.style.display = 'none'; }

        let isThaiHidden = false;
        function toggleThai() { isThaiHidden = !isThaiHidden; applyThaiState(); }
        function applyThaiState() {
            const thaiElem = document.getElementById('thaiContent');
            const btn = document.getElementById('btn-toggle-thai');
            const btnIcon = btn.querySelector('i');
            if (isThaiHidden) { thaiElem.classList.add('hidden'); btnIcon.classList.remove('fa-eye'); btnIcon.classList.add('fa-eye-slash'); }
            else { thaiElem.classList.remove('hidden'); btnIcon.classList.remove('fa-eye-slash'); btnIcon.classList.add('fa-eye'); }
        }
        function addNote() {
            const card = document.getElementById('cardContainer');
            const note = document.createElement('div');
            note.className = 'sticky-note'; note.contentEditable = true; note.innerText = '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            note.style.left = '50px'; note.style.top = '100px';
            const closeBtn = document.createElement('div');
            closeBtn.className = 'close-note'; closeBtn.innerHTML = '&times;'; closeBtn.contentEditable = false;
            closeBtn.onclick = function () { note.remove(); };
            note.appendChild(closeBtn); makeDraggable(note); card.appendChild(note); note.focus();
        }
        function makeDraggable(el) {
            let isDragging = false; let startX, startY, initialLeft, initialTop;
            const startDrag = (clientX, clientY) => { isDragging = true; startX = clientX; startY = clientY; initialLeft = el.offsetLeft; initialTop = el.offsetTop; el.style.zIndex = 1000; };
            const doDrag = (clientX, clientY) => { if (!isDragging) return; const dx = clientX - startX; const dy = clientY - startY; el.style.left = `${initialLeft + dx}px`; el.style.top = `${initialTop + dy}px`; };
            const stopDrag = () => { isDragging = false; el.style.zIndex = 100; };
            el.addEventListener('mousedown', (e) => { if (e.target.className === 'close-note') return; startDrag(e.clientX, e.clientY); });
            window.addEventListener('mousemove', (e) => { if (isDragging) e.preventDefault(); doDrag(e.clientX, e.clientY); });
            window.addEventListener('mouseup', stopDrag);
            el.addEventListener('touchstart', (e) => { if (e.target.className === 'close-note') return; const touch = e.touches[0]; startDrag(touch.clientX, touch.clientY); });
            window.addEventListener('touchmove', (e) => { if (isDragging) { const touch = e.touches[0]; doDrag(touch.clientX, touch.clientY); } });
            window.addEventListener('touchend', stopDrag);
        }
        function removeAllNotes() { document.querySelectorAll('.sticky-note').forEach(n => n.remove()); }
        window.toggleHighlight = function (element) { element.classList.toggle('translated'); }
        window.resetHighlights = function () { document.querySelectorAll('.word-span').forEach(el => el.classList.remove('translated')); }
        function nextSlide() { if (currentIndex < slides.length - 1) { currentIndex++; updateSlide(); } }
        function prevSlide() { if (currentIndex > 0) { currentIndex--; updateSlide(); } }
        document.addEventListener('keydown', function (event) { if (event.key === "ArrowRight") nextSlide(); if (event.key === "ArrowLeft") prevSlide(); });

        updateSlide();
    </script>
</body>

</html>