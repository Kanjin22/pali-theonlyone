<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏ö‡∏≤‡∏•‡∏µ (Interactive Board)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Niramit:wght@400;500;600&family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- ‡πÉ‡∏ä‡πâ Font Awesome ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- CSS ‡πÄ‡∏î‡∏¥‡∏° (‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô) --- */
        body { margin: 0; padding: 0; background-color: #eceff1; font-family: 'Sarabun', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: #37474f; overflow: hidden; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô scrollbar ‡∏ã‡πâ‡∏≠‡∏ô */ }
        
        /* --- ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏´‡∏•‡∏±‡∏Å --- */
        .card {
            width: 95%; max-width: 1000px; height: 85vh; max-height: 800px;
            background-color: #ffffff; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            display: flex; flex-direction: column; overflow: hidden; position: relative;
        }
        
        /* --- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Canvas) --- */
        .content-wrapper {
            position: relative; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Canvas ‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡πÑ‡∏î‡πâ */
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* ‡∏ã‡πà‡∏≠‡∏ô scrollbar ‡∏Ç‡∏≠‡∏á wrapper */
        }

        .content-area {
            flex: 1;
            padding: 40px 100px 20px 100px;
            overflow-y: auto; /* ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ */
            display: flex; flex-direction: column; justify-content: flex-start; align-items: stretch; text-align: left;
            z-index: 1; /* ‡∏≠‡∏¢‡∏π‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î */
        }
        
        /* --- Canvas ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏≤‡∏î‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô (‡πÅ‡∏ú‡πà‡∏ô‡πÉ‡∏™) --- */
        #drawing-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 5; /* ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ ‡πÅ‡∏ï‡πà‡πÉ‡∏ï‡πâ Tool */
            pointer-events: none; /* ‡∏õ‡∏Å‡∏ï‡∏¥‡πÉ‡∏´‡πâ‡∏ó‡∏∞‡∏•‡∏∏‡∏ú‡πà‡∏≤‡∏ô (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÑ‡∏î‡πâ) */
            cursor: crosshair;
        }
        .drawing-mode #drawing-canvas {
            pointer-events: auto; /* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏≤‡∏î ‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÑ‡∏î‡πâ */
        }

        /* --- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (Sticky Note) --- */
        .sticky-note {
            position: absolute;
            background: #fff9c4;
            border: 1px solid #fbc02d;
            padding: 10px;
            min-width: 150px;
            max-width: 300px;
            border-radius: 5px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
            z-index: 20;
            font-size: 1rem;
            cursor: move;
        }
        .sticky-note:focus { outline: 2px solid #2980b9; }
        .close-note {
            position: absolute; top: -10px; right: -10px;
            background: #e74c3c; color: white;
            border-radius: 50%; width: 20px; height: 20px;
            text-align: center; line-height: 20px;
            font-size: 12px; cursor: pointer; display: none;
        }
        .sticky-note:hover .close-note { display: block; }

        /* --- ‡πÅ‡∏ñ‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ (Toolbar) --- */
        .toolbar {
            position: absolute;
            top: 20px; right: 20px;
            background: white;
            padding: 8px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 50;
        }
        .tool-btn {
            width: 40px; height: 40px;
            border: none; background: #f0f0f0;
            border-radius: 8px; cursor: pointer;
            font-size: 1.2rem; color: #555;
            transition: all 0.2s;
            display: flex; justify-content: center; align-items: center;
        }
        .tool-btn:hover { background: #e0e0e0; }
        .tool-btn.active { background: #3498db; color: white; }
        .tool-divider { height: 1px; background: #ddd; margin: 4px 0; }
        
        /* ‡∏™‡∏µ‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤ */
        .color-dot { width: 24px; height: 24px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 0 2px #ddd; cursor: pointer; }
        .color-dot.active { box-shadow: 0 0 0 2px #3498db; transform: scale(1.1); }

        /* --- CSS ‡πÄ‡∏î‡∏¥‡∏° (‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤) --- */
        .header-bar { height: 6px; background: linear-gradient(90deg, #263238, #546e7a, #78909c); width: 100%; flex-shrink: 0; }
        .content-area::-webkit-scrollbar { width: 6px; }
        .content-area::-webkit-scrollbar-thumb { background-color: #cfd8dc; border-radius: 4px; }
        .pali-text { font-family: 'Niramit', serif; font-size: 1.8rem; color: #263238; font-weight: 500; line-height: 1.8; margin-bottom: 25px; text-align: justify; text-indent: 50px; word-break: normal; overflow-wrap: break-word; }
        .divider { width: 50px; height: 4px; background-color: #cfd8dc; border-radius: 2px; margin: 0 auto 25px auto; flex-shrink: 0; }
        .thai-text { font-family: 'Sarabun', sans-serif; font-size: 1.3rem; color: #546e7a; line-height: 1.8; font-weight: 300; text-align: justify; text-indent: 50px; word-break: normal; overflow-wrap: break-word; }
        .footer-box { background-color: #f7f9f9; border-top: 1px solid #eceff1; height: 150px; display: flex; padding: 0; flex-shrink: 0; position: relative; z-index: 10; }
        .footer-section { flex: 1; padding: 15px 25px; border-right: 1px solid #eceff1; display: flex; flex-direction: column; text-align: left; overflow-y: auto; }
        .footer-section:last-child { border-right: none; }
        .sec-title { font-size: 0.8rem; font-weight: 700; color: #90a4ae; text-transform: uppercase; margin-bottom: 8px; letter-spacing: 0.5px; border-bottom: 1px solid #cfd8dc; padding-bottom: 3px; }
        .sec-content { font-size: 0.95rem; color: #37474f; line-height: 1.5; }
        .pali-word { font-family: 'Niramit', serif; color: #0277bd; font-weight: 500; }
        .page-badge { position: absolute; top: 20px; right: 80px; /* ‡∏Ç‡∏¢‡∏±‡∏ö‡∏´‡∏ô‡∏µ toolbar */ background-color: rgba(236, 239, 241, 0.9); padding: 6px 12px; border-radius: 8px; font-size: 0.9rem; color: #78909c; font-weight: bold; z-index: 10; }
        
        .controls { position: fixed; bottom: 25px; display: flex; gap: 20px; z-index: 100; }
        button.nav-btn { padding: 12px 30px; background-color: #455a64; border: none; border-radius: 50px; font-family: 'Sarabun', sans-serif; font-size: 1rem; font-weight: 600; color: #ffffff; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: all 0.3s ease; }
        button.nav-btn:hover { background-color: #607d8b; transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.25); }
        
        @keyframes slideIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .animate-content { animation: slideIn 0.4s ease-out forwards; }

        @media screen and (max-width: 768px) {
            .card { height: 90vh; margin-top: -40px; }
            .content-area { padding: 60px 20px 40px 20px; }
            .pali-text { font-size: 1.3rem; margin-bottom: 15px; }
            .thai-text { font-size: 1.1rem; }
            .footer-box { height: auto; flex-direction: column; overflow-y: auto; min-height: 120px; max-height: 30%; }
            .footer-section { border-right: none; border-bottom: 1px solid #eceff1; padding: 10px 20px; }
            .controls { bottom: 10px; gap: 10px; }
            button.nav-btn { padding: 10px 20px; font-size: 0.9rem; }
            .toolbar { top: auto; bottom: 20px; right: 20px; flex-direction: row; } /* ‡∏¢‡πâ‡∏≤‡∏¢ toolbar ‡∏•‡∏á‡∏•‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
            .page-badge { right: 20px; }
        }
    </style>
</head>
<body>

    <div class="card">
        <div class="header-bar"></div>
        <div class="page-badge" id="pageNumber">1</div>

        <!-- Toolbar ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ -->
        <div class="toolbar">
            <button class="tool-btn" id="btn-pointer" title="‡πÇ‡∏´‡∏°‡∏î‡∏≠‡πà‡∏≤‡∏ô (‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠)" onclick="setTool('pointer')"><i class="fa-solid fa-arrow-pointer"></i></button>
            <button class="tool-btn" id="btn-pen" title="‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤" onclick="setTool('pen')"><i class="fa-solid fa-pen"></i></button>
            <button class="tool-btn" id="btn-highlighter" title="‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå" onclick="setTool('highlighter')"><i class="fa-solid fa-highlighter"></i></button>
            <div class="tool-divider"></div>
            
            <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ -->
            <div style="display:flex; flex-direction:column; gap:5px; align-items:center;">
                <div class="color-dot active" style="background:#ef5350;" onclick="setColor('#ef5350', this)"></div> <!-- ‡πÅ‡∏î‡∏á -->
                <div class="color-dot" style="background:#42a5f5;" onclick="setColor('#42a5f5', this)"></div> <!-- ‡∏ü‡πâ‡∏≤ -->
                <div class="color-dot" style="background:#66bb6a;" onclick="setColor('#66bb6a', this)"></div> <!-- ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß -->
                <div class="color-dot" style="background:#ffca28;" onclick="setColor('#ffca28', this)"></div> <!-- ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á -->
            </div>

            <div class="tool-divider"></div>
            <button class="tool-btn" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (Note)" onclick="addNote()"><i class="fa-solid fa-note-sticky"></i></button>
            <button class="tool-btn" title="‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠" onclick="clearCanvas()"><i class="fa-solid fa-trash-can"></i></button>
        </div>

        <!-- Wrapper ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô Layer -->
        <div class="content-wrapper" id="contentWrapper">
            <!-- Canvas ‡∏ß‡∏≤‡∏î‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô -->
            <canvas id="drawing-canvas"></canvas>

            <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ -->
            <div class="content-area animate-content" id="mainContent">
                <div class="pali-text" id="paliContent">...</div>
                <div class="divider"></div>
                <div class="thai-text" id="thaiContent">...</div>
            </div>
        </div>

        <div class="footer-box">
            <div class="footer-section" style="flex: 1.2;">
                <div class="sec-title">üìù ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó / ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</div>
                <div class="sec-content" id="contextContent">...</div>
            </div>
            <div class="footer-section" style="flex: 0.8;">
                <div class="sec-title">üîπ ‡∏Å‡∏¥‡∏£‡∏¥‡∏¢‡∏≤‡∏≠‡∏≤‡∏Ç‡∏¢‡∏≤‡∏ï (‡∏Ñ‡∏∏‡∏°‡∏û‡∏≤‡∏Å‡∏¢‡πå)</div>
                <div class="sec-content pali-word" id="akhyataContent">...</div>
            </div>
            <div class="footer-section" style="flex: 1;">
                <div class="sec-title">üî∏ ‡∏Å‡∏¥‡∏£‡∏¥‡∏¢‡∏≤‡∏Å‡∏¥‡∏ï‡∏Å‡πå / ‡∏ï ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢</div>
                <div class="sec-content pali-word" id="kitakaContent">...</div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="nav-btn" onclick="prevSlide()">‚ùÆ ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="nav-btn" onclick="nextSlide()">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ùØ</button>
    </div>

    <script src="slides-data.js"></script>

    <script>
        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Slide ---
        const params = new URLSearchParams(window.location.search);
        const slideId = params.get('id');
        let slides = [];
        if (slideId && typeof slidesDatabase !== 'undefined' && slidesDatabase[slideId]) {
            slides = slidesDatabase[slideId];
        } else {
            slides = [{ pali: "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô", thai: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™ (ID)", context: "-", akhyata: "-", kitaka: "-" }];
        }

        let currentIndex = 0;
        const mainContent = document.getElementById('mainContent');
        const contentArea = document.querySelector('.content-area');
        
        function updateSlide() {
            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            clearCanvas(true);
            removeAllNotes();

            mainContent.classList.remove('animate-content');
            void mainContent.offsetWidth; 
            mainContent.classList.add('animate-content');
            contentArea.scrollTop = 0;

            const s = slides[currentIndex];
            document.getElementById('paliContent').innerText = s.pali;
            document.getElementById('thaiContent').innerText = s.thai;
            document.getElementById('contextContent').innerText = s.context;
            document.getElementById('akhyataContent').innerText = s.akhyata;
            document.getElementById('kitakaContent').innerText = s.kitaka;
            document.getElementById('pageNumber').innerText = `${currentIndex + 1} / ${slides.length}`;
        }

        function nextSlide() {
            if (currentIndex < slides.length - 1) { currentIndex++; updateSlide(); }
        }
        function prevSlide() {
            if (currentIndex > 0) { currentIndex--; updateSlide(); }
        }
        document.addEventListener('keydown', function(event) {
            if (event.key === "ArrowRight") nextSlide();
            if (event.key === "ArrowLeft") prevSlide();
        });

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Whiteboard ---
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        const wrapper = document.getElementById('contentWrapper');
        let isDrawing = false;
        let currentTool = 'pointer'; // pointer, pen, highlighter
        let currentColor = '#ef5350';
        let lastX = 0;
        let lastY = 0;

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ç‡∏ô‡∏≤‡∏î Canvas ‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏à‡∏≠‡πÄ‡∏™‡∏°‡∏≠
        function resizeCanvas() {
            canvas.width = wrapper.offsetWidth;
            canvas.height = wrapper.offsetHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î
        setTimeout(resizeCanvas, 100);

        function setTool(tool) {
            currentTool = tool;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏õ‡∏∏‡πà‡∏°
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${tool}`).classList.add('active');

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏•‡∏≤‡∏™ wrapper ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô cursor
            if (tool === 'pointer') {
                wrapper.classList.remove('drawing-mode');
            } else {
                wrapper.classList.add('drawing-mode');
            }
        }
        
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô Pointer
        setTool('pointer');

        function setColor(color, element) {
            currentColor = color;
            document.querySelectorAll('.color-dot').forEach(dot => dot.classList.remove('active'));
            element.classList.add('active');
        }

        // Event Listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏î
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);
        
        // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Touch Screen
        canvas.addEventListener('touchstart', (e) => {
            if(currentTool === 'pointer') return;
            e.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏à‡∏≠
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent("mousedown", { clientX: touch.clientX, clientY: touch.clientY });
            canvas.dispatchEvent(mouseEvent);
        });
        canvas.addEventListener('touchmove', (e) => {
            if(currentTool === 'pointer') return;
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent("mousemove", { clientX: touch.clientX, clientY: touch.clientY });
            canvas.dispatchEvent(mouseEvent);
        });
        canvas.addEventListener('touchend', (e) => {
            if(currentTool === 'pointer') return;
            const mouseEvent = new MouseEvent("mouseup", {});
            canvas.dispatchEvent(mouseEvent);
        });

        function startDrawing(e) {
            if (currentTool === 'pointer') return;
            isDrawing = true;
            [lastX, lastY] = [e.offsetX, e.offsetY];
        }

        function draw(e) {
            if (!isDrawing) return;
            if (currentTool === 'pointer') return;

            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(e.offsetX, e.offsetY);
            
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            if (currentTool === 'pen') {
                ctx.strokeStyle = currentColor;
                ctx.lineWidth = 3;
                ctx.globalAlpha = 1.0;
            } else if (currentTool === 'highlighter') {
                ctx.strokeStyle = currentColor;
                ctx.lineWidth = 20;
                ctx.globalAlpha = 0.3; // ‡∏à‡∏≤‡∏á‡πÜ ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠
            }

            ctx.stroke();
            [lastX, lastY] = [e.offsetX, e.offsetY];
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function clearCanvas(keepNotes = false) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (!keepNotes) removeAllNotes();
        }

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Sticky Notes ---
        function addNote() {
            const note = document.createElement('div');
            note.className = 'sticky-note';
            note.contentEditable = true;
            note.innerText = '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢...';
            note.style.left = '50px';
            note.style.top = '50px';
            
            // ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö
            const closeBtn = document.createElement('div');
            closeBtn.className = 'close-note';
            closeBtn.innerHTML = '&times;';
            closeBtn.contentEditable = false;
            closeBtn.onclick = function() { note.remove(); };
            
            note.appendChild(closeBtn);
            
            // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏•‡∏≤‡∏Å‡πÑ‡∏î‡πâ
            makeDraggable(note);
            
            wrapper.appendChild(note);
            note.focus();
        }

        function removeAllNotes() {
            const notes = document.querySelectorAll('.sticky-note');
            notes.forEach(n => n.remove());
        }

        function makeDraggable(el) {
            let isDragging = false;
            let startX, startY, initialLeft, initialTop;

            el.addEventListener('mousedown', function(e) {
                if (e.target.className === 'close-note') return;
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                initialLeft = el.offsetLeft;
                initialTop = el.offsetTop;
            });

            window.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                el.style.left = `${initialLeft + dx}px`;
                el.style.top = `${initialTop + dy}px`;
            });

            window.addEventListener('mouseup', () => isDragging = false);
        }

        // Initialize App
        updateSlide();
        
    </script>
</body>
</html>